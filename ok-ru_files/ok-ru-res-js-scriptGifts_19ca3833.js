OK.gifts=function(t,e){"use strict";var a,i,s,r,n="click",l=".gift-front_cnt",c="resize",o="search-input_searching",d="search-input_active",u="__process";function v(){$("#ifDcards").height($(t).height()-250).scroll(),$(t).scroll()}var f,g,m=null;return{activateFriendSelectPopup:function(){setTimeout((function(){$("#popLayerBodyWrapper").css("top","60px"),v()}),1),$(t).bind(c,v)},deActivateFriendSelectPopup:function(){$(t).unbind(c,v)},activateGiftsFront:function(t,c){if(a=$("#gf-search-form"),i=$("#gf-search-input"),s=0===a.length){r=e.getElementById("field_qs");var v=e.getElementById("gifts-tags-container");v&&v.addEventListener("click",(function(t){t.target.classList.contains("js-tag")&&OK.gifts.doSearch(t.target.innerHTML)}),!1)}else{var p=$("#gf-search-lupa"),_=($("#gf-search-progress"),$("#gf-search-reset"));OK.onload.addCallback((function(){a[0]&&(a[0].onsubmit=function(){return f===i.val().trim()?($(l).removeClass(u),!1):($(l).addClass(u),f=i.val().trim(),a.toggleClass(d,""!==f),this.onsubmitGwt())})})),p.bind(n,(function(){a.submit()})),i.val()&&""!==i.val().trim()&&a.addClass(d);var C=function(){g=!0,$(l).addClass(u),a.submit()};t&&i.on("keyup",(function(){var t=i.val().trim(),e=""===t;return null!==m&&clearTimeout(m),f!==t?e?C():(a.toggleClass(d,!e),a.addClass(o),m=setTimeout(C,c)):($(l).removeClass(u),a.removeClass(d)),!0})),_.bind(n,(function(){i.val(""),a.removeClass(d),a.submit(),i.focus()})),a.on(n,".js-tag",(function(){OK.gifts.doSearch(this.innerHTML)}))}},giftsFrontContentLoaded:function(){s||(a.removeClass(o),f=i.val()?i.val().trim():"",g&&(setTimeout((function(){i.focus()}),100),g=!1))},doSearch:function(t){OK.logging.logger.success("giftFront","tagClick",t),s?(r.value=t,r.dispatchEvent(new CustomEvent("paste"))):(i.val(t),a.addClass(d),a.submit())}}}(window,document),OK.musicalGifts=function(){"use strict";var t,e,a,i,s,r,n,l,c,o="#music-gifts-content",d=null,u="click",v="search-input_searching",f="search-input_active",g="__process";function m(t,e){return p(t,e,0)}function p(t,e,a){return t.getAttribute(e)?{value:t.getAttribute(e),action:t.getAttribute("action")}:a<5?p(t.parentNode,e,++a):void 0}function _(t){return t.getAttribute("data-query")}function C(t){require(["OK/music2/app"],(function(e){var a;e.play(Number(t),{ctx:"gifts",tids:(a=document.getElementById("music-gifts-content"),Array.prototype.slice.call(a.childNodes).map(_).filter(Boolean).join(","))})}))}function b(t){if(t&&(t.id===e&&t.playing||function(){var t=e&&document.getElementById("gt_"+e);if(t){var a=t.querySelector(".js-track_play");a&&a.classList.remove("m_portal_track_pause")}}(),t.playing)){var a=document.getElementById("gt_"+t.id);if(a){var i=a.querySelector(".js-track_play");i&&i.classList.add("m_portal_track_pause")}e=t.id}}function h(e){var s=e.target||e.srcElement;0;var n=m(s,"data-query"),c=m(s,"send-present-link"),o=m(s,"linkOnSelectFriend"),d=m(s,"alt-link"),u=$("#hook_FormButton_button-add");if(void 0!==n)if("select"===n.action){if(t||($("#giftMusicIco").removeClass("__disabled"),$("#sendMP").removeClass("invisible"),$("#gmSelectedTr").removeClass("invisible"),$("#sendMPD").addClass("invisible"),y(u,!0)),t!==n.value){$("#gt_"+t).removeClass("__selected"),$("#gt_"+t).attr("data-redesign")&&$("#gt_"+t+" div:first").removeClass("__selected"),S(t=n.value),a=void 0!==c?c.value:"",i=void 0!==d?d.value:"";var v=void 0!==o?o.value:"";$("#giftMusicIco").attr("data-query",t),$("#mg-track-id").val(t),$("#sendMP").attr("data-query",a).attr("data-alt",i),$("#linkOpenSelFriend").attr("data-query",v);var f=$("#gt_"+n.value);f.addClass("__selected"),f.attr("data-redesign")&&$("#gt_"+n.value+" div:first").addClass("__selected"),$("#gmSelectedTr").html('<span class="lp-t">'+f.attr("data-artist")+"</span> â€“ "+f.attr("data-track"))}s.classList.contains("track_play")&&C(t)}else if("play"===n.action)C(t);else if("link"===n.action){var g=n.value;l.val(""),"sendMP"===s.getAttribute("id")&&(r||(g=s.getAttribute("data-alt")),t&&(g+="&st.layer.trackId="+t)),y(u,!1),navigateOnUrlFromJS(g),OK.historyManager.pushState(g),e.preventDefault()}}function y(t,e){e?(t.removeClass("__disabled"),t.removeAttr("disabled")):(t.addClass("__disabled"),t.attr("disabled","disabled"))}function k(){var t=l.val().trim();return n.toggleClass(f,""!==t),null!==d&&clearTimeout(d),c!==t?(d=setTimeout((function(){!0,n.submit()}),500),$(o).addClass(g)):$(o).removeClass(g),!0}function S(t){$("input#field_trackId[name='st.layer.trackId']").attr("value",t)}return{bind:function(e,a,i){OK.loader.use("jQuery",(function(){!function(){n=$("#mg-search-form");var d=$("#giftMSCC").attr("data-query");n.attr("action",d),l=$("#mg-search-input");var m=$("#mg-search-lupa"),p=($("#mg-search-progress"),$("#mg-search-reset"));e||(s=void 0);if(S(t=e),$("#mg-track-id").val(t),r=a,e){var _=$("#giftMusicIco");_.attr("data-query",t),t===s&&($("#gt_"+s).addClass("__selected"),$("#gt_"+s).attr("data-redesign")&&$("#gt_"+s+" div:first").addClass("__selected"),_.addClass("__animated"))}$("#giftMSCC").click(h),require("OK/music2/app").on("current-track-changed",b),n.removeClass(v),c=l.val()?l.val().trim():"",void!1,i&&(l.on("keyup",k),OK.onload.addCallback((function(){n[0]&&(n[0].onsubmit=function(){return c===l.val().trim()?($(o).removeClass(g),!1):($(o).addClass(g),n.addClass(v),c=l.val().trim(),n.toggleClass(f,""!==c),this.onsubmitGwt())})})),m.bind(u,(function(){n.submit()})),l.val()&&""!==l.val().trim()&&n.addClass(f),p.bind(u,(function(){l.val(""),n.removeClass(f),n.submit(),l.focus()})))}()}))},deActivate:function(){S(t=null),$("#giftMSCC").off("click",h),require("OK/music2/app").off("current-track-changed",b)}}}();
//# sourceMappingURL=/res/source-maps/js/scriptGifts.js.map