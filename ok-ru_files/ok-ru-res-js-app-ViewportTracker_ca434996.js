define(["OK/utils/throttle","OK/utils/dom"],(function(t,e){"use strict";var i="js-viewport-container",n=[],s=!1,o=t(100,(function(){n.forEach((function(t){t.calculate()}))}));function r(t){var e=null;return n.some((function(i){if(i.element===t)return e=i,!0})),e}function c(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}function l(t,e,i,n){this.element=t,this.container=e,this.callback=i,this.predicate=n?n.bind(this):null}function u(e){this.element=e,this.items=[],this.listener=t(100,this.calculate.bind(this)),this.element.addEventListener("scroll",this.listener),this.updateRect()}return l.prototype={destroy:function(){this.container=null},isInViewport:function(){var t,e=this.container.rect,i=e.top,n=e.bottom;try{t=this.element.getBoundingClientRect()}catch(e){t={top:0,right:0,bottom:0,left:0,width:0,height:0}}return t.top>=i&&t.top<=n||t.bottom>=i&&t.bottom<=n},calculate:function(){var t=this.predicate?this.predicate():this.isInViewport();this.visible!==t&&(this.visible=t,this.callback.call(this.element,t))}},u.prototype={add:function(t){this.items.push(t),this.updateRect(),t.calculate()},updateRect:function(){this.rect=this.element.getBoundingClientRect()},remove:function(t){var e=null;this.items.forEach((function(i){if(i.element===t)return e=i,!0})),e&&(e.destroy(),c(this.items,e))},isEmpty:function(){return 0===this.items.length},isLast:function(t){return this.items[this.items.length-1]===t},calculate:function(){this.updateRect(),this.items.forEach((function(t){t.calculate()}))},destroy:function(){this.element.removeEventListener("scroll",this.listener)}},{add:function(t,c,a){var h,d=e.parent(t,i);null===d&&(d=window),(h=r(d))||(h=new u(d),n.push(h)),h.add(new l(t,h,c,a)),s||(window.addEventListener("resize",o),s=!0)},remove:function(t){var l,u=e.parent(t,i);null===u&&(u=window),(l=r(u))&&(l.remove(t),l.isEmpty()&&(l.destroy(),c(n,l))),s&&0===n.length&&(window.removeEventListener("resize",o),s=!1)},getContainer:function(t){return r(e.parent(t,i))}}}));
//# sourceMappingURL=/res/source-maps/js/app/ViewportTracker.js.map