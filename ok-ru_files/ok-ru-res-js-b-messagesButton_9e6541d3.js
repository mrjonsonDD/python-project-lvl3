define("OK/messages/BrowserNotifications",["PTS/messaging.client","OK/logger","OK/utils/dom","OK/utils/vanilla","OK/WebPush","OK/NotificationPermissionPopup"],(function(e,t,n,r,i,a){"use strict";var o,s,l,u="notification_enabled_messenger",f="notification_enabled_messenger_pro",c="notification_enabled_messenger_pro_hidden_till",d="js-notifications-on",h="js-notifications-off",g="__hidden",p="messages-tumbler-toggle",m="data-web-push-interop-enabled",v="data-web-push-extended-settings-enabled",y=[],b=!1,w=!1,I=!1;function E(){return window.Notification&&"granted"===window.Notification.permission}function A(){return E()&&P()}function P(){return window.localStorage&&"0"!==window.localStorage.getItem(u)}function S(){return window.Notification&&"denied"===window.Notification.permission}function O(e,t,n){e&&e.classList.toggle("invisible",n),t&&t.classList.toggle("invisible",!n)}function T(){return OK.cnst.staticUrl+"res/i/html5_notif_icon.png"}function C(e,n,r,i,a){r=r||T();var o=new Notification(e,{body:n,icon:r,tag:i});return function(e,n){e.onshow=function(){t.success("html5.ntf.shown"),setTimeout(e.close.bind(e),7e3)},e.onclose=function(){y.some((function(t,n){if(t===e)return y.splice(n,1),!0}))},e.onclick=function(){t.success("html5.ntf.click"),n&&n.call()}}(o,a),y.push(o),o}function x(t,n,r){r?r.checked=P():O(t,n,A());return C(e["html5.notification.enabled.title"],e["html5.notification.enabled.body"],T(),"messenger-enabled")}function L(e,n,r){return!(!localStorage||!Notification)&&("default"===Notification.permission?Notification.requestPermission((function(a){"granted"===a?(t.success("html5.ntf.granted"),localStorage.setItem(u,"1"),i.subscribe("messages").then((function(e){w&&e===i.STATUS_SUBSCRIBED&&B(!0)}),_),x(e,n,r)):"denied"===a&&t.success("html5.ntf.denied")})):"denied"===Notification.permission?b&&a.open((function(){"denied"!==Notification.permission&&L(e,n,r)})):(t.success("html5.ntf.enabled"),localStorage.setItem(u,"1"),i.subscribe("messages").then((function(e){w&&e===i.STATUS_SUBSCRIBED&&B(!0)}),_),x(e,n,r)),!1)}function D(e){e.target.checked?L(null,null,e.target):(window.localStorage&&window.localStorage.setItem(u,"0"),t.success("html5.ntf.disable"),w?B(!1):i.unsubscribe("messages").catch(_))}function F(e,t){return e.parentNode.getElementsByClassName(t)[0].parentNode}function _(){OK.fn.isDebug()&&console.error.apply(console,arguments)}function R(e){localStorage.setItem(f,"1"),e.classList.add(g)}function B(e){i.isEnabled()&&r.ajax({method:"POST",url:"/web-api/webpush/messages?enabled="+(e?"true":"false")})}return{activate:function(e){if(w="true"===e.getAttribute(v),b="true"===e.getAttribute(m),I="true"===e.getAttribute("data-is-new-settings")){var n=e.getAttribute("data-current-user-id");n&&(u=u+"_"+n),null==localStorage.getItem(u)&&(t.success("message.notifications.firsttime"),window.localStorage.setItem(u,"1"));var r=document.getElementById(p);return r.checked=P(),void r.addEventListener("click",D)}var a=F(e,d),o=F(e,h);!S()||b?(a.notifClickListener=function(e,t){return function(n){L(e,t),O(e,t,A()),n.stopPropagation(),n.preventDefault()}}(a,o),o.notifClickListener=function(e,n){return function(r){window.localStorage&&window.localStorage.setItem(u,"0"),O(e,n,A()),r.stopPropagation(),r.preventDefault(),t.success("html5.ntf.disable"),w?B(!1):i.unsubscribe("messages").catch(_)}}(a,o),O(a,o,A()),a.addEventListener("click",a.notifClickListener),o.addEventListener("click",o.notifClickListener)):function(e,t){e.classList.add("invisible"),t.classList.add("invisible")}(a,o)},deactivate:function(e){if(I){document.getElementById(p).removeEventListener("click",D)}else{var t=F(e,d),n=F(e,h);t.notifClickListener&&(t.removeEventListener("click",t.notifClickListener),t.notifClickListener=null),n.notifClickListener&&(n.removeEventListener("click",n.notifClickListener),n.notifClickListener=null)}},activatePro:function(e){if(!(A()||window.localStorage&&"1"===window.localStorage.getItem(f)||function(){if(window.localStorage){var e=window.localStorage.getItem(c),t=new Date;if(e)return t<new Date(e)}return!1}())&&(w="true"===e.getAttribute(v),b="true"===e.getAttribute(m),!S()||b)){if(o=n.firstByClass(e,"js-browser-notif-pro_enable"),s=n.firstByClass(e,"js-browser-notif-pro_delay"),l=n.firstByClass(e,"js-browser-notif-pro_close"),o.notifProClickListener=function(e){return function(t){var r=n.firstByClass(document,d),i=n.firstByClass(document,h);r&&(r=r.parentNode),i&&(i=i.parentNode),L(r,i),R(e)}}(e),o.addEventListener("click",o.notifProClickListener),s){var t=parseInt(s.getAttribute("data-delay"),10);s.notifProDelayListener=function(){!function(e,t){var n=new Date;n.setSeconds(n.getSeconds()+t),localStorage.setItem(c,n),e.classList.add(g)}(e,t)},s.addEventListener("click",s.notifProDelayListener)}l&&(l.notifProCloseListener=function(){R(e)},l.addEventListener("click",l.notifProCloseListener)),setTimeout((function(){e.classList.remove(g)}),1e3)}},deactivatePro:function(e){o&&o.notifProClickListener&&(o.removeEventListener("click",o.notifProClickListener),o.notifProClickListener=null,o=null),s&&s.notifProDelayListener&&(s.removeEventListener("click",s.notifProDelayListener),s.notifProDelayListener=null,o=null),l&&l.notifProCloseListener&&(l.removeEventListener("click",l.notifProCloseListener),l.notifProClickListener=null,l=null)},show:C,closeAll:function(){y.forEach((function(e){e.close()})),y=[]},isEnabled:A,isPermitionGranted:E,toggle:function(e){localStorage&&localStorage.setItem(u,e?"1":"0")}}})),define("OK/messages/WindowVisibility",[],(function(){"use strict";var e="hasFocus"in document,t=!0,n=[];function r(e){e=e||window.event,t="focus"===e.type,n.forEach((function(e){t&&e.onWindowFocus&&e.onWindowFocus(),!t&&e.onWindowBlur&&e.onWindowBlur()}))}return window.addEventListener("focus",r),window.addEventListener("blur",r),{hasFocus:function(){return e?document.hasFocus():t},addListener:function(e){n.push(e)},removeListener:function(e){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}})),define("OK/ToolbarGrowl",["OK/logger","OK/utils/dom"],(function(e,t){"use strict";var n="__active",r="growl",i="click",a="data-id",o=function(){var t,n,i=document.createElement("bootstrap"),a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(n in a)if(a.hasOwnProperty(n)&&void 0!==i.style[n]){t=a[n];break}return e.success(r,"transition",t),t}(),s=null,l={},u=document.getElementById("msg_toolbar_button"),f=!(!u||!u.getAttribute("data-growl-add-log")),c=!!document.querySelector(".js-msg-ok"),d=!!document.querySelector(".js-msg-tt");function h(e){return e&&parseInt(e.getAttribute("data-time"),10)||0}function g(){return!(OK.Layers&&OK.Layers.isAnyLayerOpened()||document.getElementById("CallApplication")||document.querySelector(".discovery-menu.with-search.__search-wide")||"appMain"===OK.getCurrentDesktopModelId())}function p(e){return t.firstByClass(e,"growl_close")}function m(e){this.hookId=e,this.hidden=!0,this.stash=null}return m.showAny=function(){var e,t;if(!s)for(e in l)if(l.hasOwnProperty(e)&&(t=l[e]).hidden&&(t.show(),!t.hidden))break},m.hideAll=function(){s&&s.hide()},m.destroyByLayerId=function(e){var t=l[e];t&&t.destroy()},m.getByLayerId=function(e){return l[e]},m.prototype={activate:function(e){this.hook=this.getContentHook(),this.layerId=e.getAttribute("data-layer"),this.exclusive="true"===e.getAttribute("data-exclusive"),this.priority=parseInt(e.getAttribute("data-priority"),10)||0,l[this.layerId]=this,this.hook&&(this.elem=this.hook.element.firstChild,this.elem&&(this.activateGrowl(),this.id=this.elem.getAttribute(a),this.time=h(this.elem))),this.show()},activateGrowl:function(){var e=p(this.elem);e&&e.addEventListener(i,this)},deactivateGrowl:function(){var e=p(this.elem);e&&e.removeEventListener(i,this)},show:function(){if(this.id&&g.call(this)){if(s){if(this.priority<=s.priority)return;e.success(r,"replace",this.layerId),s.hide()}if(this.elem.classList.add(n),this.hidden=!1,s=this,e.success(r,"show","music_app"===this.layerId?this.layerId+"-"+this.id:this.layerId),"messages"===this.layerId&&f){var t=d?"tt":c?"ok":"unknown";return e.success("messagesLayer","growl",t)}}},hide:function(){this.elem&&(this.elem.classList.remove(n),this.hidden=!0,this===s&&(s=null))},destroy:function(){this.elem&&(this.deactivateGrowl(),this.hide(),this.id=null,this.time=null,this.elem=null)},setNewContent:function(t){var n,i,s=this,l=function(e){var t=document.createElement("div");return t.innerHTML=e,t.children.length?t.children[0]:null}(t);if(OK.Layers&&OK.Layers.isLayerOpened(s.layerId))e.success(r,"ignore");else if(l){if(n=l.getAttribute(a),i=h(l),this.exclusive&&this.id&&this.id!==n)return;if(s.id===n&&s.time===i)return void e.success(r,"equal",1);s.hidden?this.setNewGrowl(t,n,i):(this.stash={html:t,id:n,time:i},this.elem.addEventListener(o,this,!1),s.destroy())}else s.destroy(),m.showAny()},applyNewContent:function(){this.hidden=!0,null===this.stash?OK.hookModel.setHookContent(this.getContentHookId(),""):(this.setNewGrowl(this.stash.html,this.stash.id,this.stash.time),e.success(r,"replace"),this.stash=null)},setNewGrowl:function(t,n,i){if(this.id!==n||this.time!==i){var a=this.getContentHook();OK.hookModel.setHookContent(a.id,t),this.elem=a.element.firstChild,this.id=n,this.time=i,this.activateGrowl(),setTimeout(this.show.bind(this),30)}else e.success(r,"equal",2)},handleEvent:function(e){var t=e.type;t===i?(this.time>this.crossTime&&(this.crossTime=this.time),this.destroy(),m.showAny()):t===o&&"opacity"===e.propertyName&&(e.target.removeEventListener(o,this),this.applyNewContent())},getContentHookId:function(){return this.hookId+"_Content"},getContentHook:function(){return this.hook||(this.hook=OK.hookModel.getHookById(this.getContentHookId())),this.hook}},m})),define("OK/messages/Helper",["OK/messages/WindowVisibility","OK/utils/dom","OK/ToolbarBubble","OK/ToolbarGrowl","OK/logger","OK/utils/vanilla"],(function(e,t,n,r,i,a){"use strict";var o="ConversationsList",s=n.wrap("counter_ToolbarMessages"),l=!!document.getElementById("msg_toolbar_button").getAttribute("data-button-add-log");function u(){return n.create("counter_GroupMessages")}function f(){return document.getElementById("js-chats_type")}function c(){var e=f();return e?e.getAttribute("data-filterTab"):null}function d(){var e=f();return e?e.getAttribute("data-filterGroupId"):null}return{isLayerOpenedAndActive:function(){return this.isWindowHasFocus()&&this.isMessageLayerOpened()},isMessageLayerOpened:function(){return OK.Layers&&OK.Layers.isLayerOpened("messages")},isWindowHasFocus:function(){return e.hasFocus()},updateToolbarBubbleFromServer:function(e){if(e)try{var t=n.wrap("counter_ToolbarMessages"),r=t.getCount(),a=e.conv;if(r!=a&&(t.resolveCustomIcon(a,e.hasReply),require(["OK/messages/MessagesAlert"],(function(e){e.updateUnread(a)}))),"GROUP"==c()&&!d()){var o=u();o&&o.resolveCustomIcon(e.group)}require.defined("OK/GroupMessagesBubbleEventBus")&&require("OK/GroupMessagesBubbleEventBus").triggerAllMessages(e.group)}catch(e){i.error("messagesLayer.error","helper_updateToolbarBubbleFromServer"),i.clob("error",e.stack,"messagesLayer","helper_updateToolbarBubbleFromServer")}},getFilterTab:c,getFilterGroupId:d,getFilterUnanswered:function(){var e=f();return e?e.getAttribute("data-filterUnanswered"):null},newMessageNotify:function(e){var t=s.getCount(),o=s.hasBubble(),f=s.countMsg();if(e){var c=f?e.msg:e.conv;if(t!==c){s.resolveCustomIcon(c,e.hasReply);var d=e.updateFaviconIfNeeded;l&&i.success("messagesLayer","bubble",d?"tt":"ok"),require(["OK/messages/MessagesAlert"],(function(t){t.updateUnread(e.conv,d)})),t>c&&(r.destroyByLayerId("messages"),e.showGrowlTT&&a.ajax({url:"/dk?cmd=MessagesGrowl"}).then((function(e){a.updateBlockModelCallback(e)})))}else o||s.resolveCustomIcon(0,!1);var h=n.create("counter_UserMessages");h&&h.resolveCustomIcon(e.conv-e.group);var g=u();g&&g.resolveCustomIcon(e.group)}else o||s.resolveCustomIcon(0,!1)},getConvLastMsgId:function(e){var n,r=(n=OK.hookModel.getHookById(o))?n.element:document.getElementById("hook_Block_"+o);if(r){var i=t.firstByClass(r,"js-lastMsg_"+e);if(i&&i.firstChild)return i.firstChild.getAttribute("data-id")}return null}}})),define("OK/messages/MessagesConfig",["OK/logger","OK/utils/utils"],(function(e,t){"use strict";var n={initialConvCount:0,initialMsgCount:0,saveUnsentMessages:!1,ajaxRetryCount:3,ajaxTimeout:1e4,lastMsgSyncFix:!1,cacheTimeout:0,poorPasteClean:!1,addCardOnRestore:!1,focusSearchOnOpen:!1,messagesCountForReset:-1,messagesCountForDisablePush:-1,hideTimestampOnVideoStart:!1,sendDeliveredToClient:!1,historyFix:!1,searchTouch:!1,newTyping:!1,copyMsgText:!1,myUnreadLeftColumn:!1,typingShowTimeout:6e3,chatListDrafts:!1,fancyScroll:!1,convDeactivateEnabled:!1,convListDuplicatesFix:!1,allowedTags:"p, br, div, img.emoji, img.usmile, img[alt^='#u'][alt$='s#']",user:{id:0,isPlaySound:!1,isStar:!1,isSendOnCtrlEnter:!1},retrySend:{timeout:0,retriesCount:0,retryDelay:0,increaseBy:1e3},attachItemVersions:{},asyncUploadEnabled:!1,sendStickerAsAttach:!1};return{activate:function(r){var i=function(t){var n=t&&t.innerHTML,r={};if(n)try{r=OK.util.parseJSON(n)}catch(t){e.error("messagesLayer.error","confParse")}return r}(r);return t.extendDeep(n,i),n},update:function(e){return t.extendDeep(n,e),n},get:function(){return n},toggleSendOnEnter:function(e){n.user.isSendOnCtrlEnter=!e}}})),define("OK/messages/SoundPlayer",[],(function(){var e="messages.nmst",t=null,n=null;function r(r){if(null==t||r!==n){var i=new Audio,a=function(t){var n=".mp3",r=".wav",i="probably",a="maybe",o=t.canPlayType("audio/mp3"),s=t.canPlayType("audio/wav");return o===i?(OK.logging.logger.success(e,"mp3.pb"),n):s===i?(OK.logging.logger.success(e,"wav.pb"),r):o===a?(OK.logging.logger.success(e,"mp3.mb"),n):s===a?(OK.logging.logger.success(e,"wav.mb"),r):(OK.logging.logger.success(e,"err"),null)}(i);a&&(i.src=r+a,i.volume=0,i.play(),n=r,t=i)}}return{initAndPlay:function(n){window.HTMLAudioElement?(r(n),t.pause(),t.src=t.src,t.volume=1,t.play(),OK.logging.logger.success("messages.pnms")):OK.logging.logger.success(e,"ns")}}})),define("OK/messages/MessagesPushController",["OK/logger","OK/NewsFetchCoordinator"],(function(e,t){"use strict";var n="PRIVATE",r=[],i={count:0,privateConv:0,chatConv:0,privateMessages:0,chatMessages:0,updateMessagesTime:0,readMarksTime:0,typingStatusesTime:0};function a(e){var t=e.unreadCount;t&&t.time&&i.count&&t.time<=i.count&&(e.unreadCount=void 0);var r=e.updatedConversations;if(r&&(i.privateConv||i.chatConv)){var a=[];Object.keys(r).forEach((function(e){var t=r[e];t.time&&t.time<=(t.type===n?i.privateConv:i.chatConv)&&a.push(e)})),a.forEach((function(t){delete e.updatedConversations[t]}))}var o=e.newMessages;o&&(i.privateMessages||i.chatMessages)&&Object.keys(o).forEach((function(e){var t=o[e],r=[];t.forEach((function(e){e.time&&e.time<=(e.type===n?i.privateMessages:i.chatMessages)||r.push(e)})),o[e]=r}));var s=e.updatedMessages;s&&i.updateMessagesTime&&Object.keys(s).forEach((function(e){var t=s[e],n=[];t.forEach((function(e){e.time&&e.time<=i.updateMessagesTime||n.push(e)})),s[e]=n}));var l=e.readMarks;l&&i.readMarksTime&&Object.keys(l).forEach((function(e){var t=l[e].list,n=[];t.forEach((function(e){e.time&&e.time<=i.readMarksTime||n.push(e)})),l[e].list=n}));var u=e.typingStatuses;u&&i.typingStatusesTime&&Object.keys(u).forEach((function(e){var t=u[e].list,n=[];t.forEach((function(e){e.time&&e.time<=i.typingStatusesTime||n.push(e)})),u[e].list=n}))}function o(e){return parseInt(e,10)||0}function s(e,t){return e+(e.length?":":"")+t}return{priority:{very_high:4,high:3,medium:2,low:1},activate:function(){t.addBlock("MPC")},register:function(e){return r.push(e),r.sort((function(e,t){return t.priority-e.priority})),function(){var t=r.indexOf(e);t>=0&&r.splice(t,1)}},applyNews:function(t){if(t){var n={};r.forEach((function(r){if(r.applyNews){if(r.dependsOn&&n.hasOwnProperty(r.dependsOn)&&!n[r.dependsOn])return void(n[r.name]=!1);try{n[r.name]=r.applyNews(t)}catch(t){n[r.name]=!1,e.error("messagesLayer","pushCtrl_"+r.name),e.clob("error",t.toString(),"messagesLayer","pushListener_applyNews")}}}))}},setNewContent:function(n){try{if(n){var r=OK.util.parseJSON(n);r&&(a(r),this.applyNews(r),function(e){var n=e.unreadCount;n&&n.time&&(p=o(n.time))>i.count&&(i.count=p);var r=e.checkTime;if(r){var a="",l=r.privateConvTime;l&&(p=o(l))>i.privateConv&&(i.privateConv=p),a=s(a,i.privateConv);var u=r.chatConvTime;u&&(p=o(u))>i.chatConv&&(i.chatConv=p),a=s(a,i.chatConv);var f=r.privateMessagesTime;f&&(p=o(f))>i.privateMessages&&(i.privateMessages=p),a=s(a,i.privateMessages);var c=r.chatMessagesTime;c&&(p=o(c))>i.chatMessages&&(i.chatMessages=p),a=s(a,i.chatMessages);var d=r.updateMessagesTime;d&&(p=o(d))>i.updateMessagesTime&&(i.updateMessagesTime=p);var h=r.readMarksTime;h&&(p=o(h))>i.readMarksTime&&(i.readMarksTime=p);var g=r.typingStatusesTime;if(g){var p=o(g);i.typingStatusesTime=p}a.length>0&&t.updateParam("st.mpCheckTime",a)}}(r))}}catch(t){e.error("messagesLayer.error","pushSetNewCnt"),e.clob("error",t.stack,"messagesLayer","processPush")}},getCheckTime:function(){return i}}})),define("OK/messages/WindowTitleChanger",["PTS/messaging.client"],(function(e){"use strict";var t,n=document.title;function r(e){document.title=e}function i(e){var n,i=arguments.length,a=0;t&&clearInterval(t),i>1?(n=arguments,t=setInterval((function(){r(n[a]),++a>=i&&(a=0)}),700)):r(e)}return{setTitle:i,resetTitle:function(){i(n)},setNewMessagesTitle:function(t){var n=OK.util.plurals(t);i(t+" "+e["new.message.count."+n])}}})),define("OK/messages/MessagesAlert",["OK/messages/MessagesConfig","OK/messages/SoundPlayer","OK/messages/BrowserNotifications","OK/messages/MessagesPushController","OK/messages/WindowTitleChanger","OK/FaviconManager","PTS/messaging.client","OK/messages/Helper","OK/NewsFetchCoordinator","OK/logger"],(function(e,t,n,r,i,a,o,s,l,u){"use strict";var f,c,d,h=!1,g=[];function p(){return e.get()}function m(){return OK.lss&&OK.lss.isMaster()}function v(){var e=performance.now();c&&e-c<3e3||(c=e,t.initAndPlay(OK.cnst.staticUrl+"res/default/sound/newMessageSound15"))}function y(){h||(f>0?i.setNewMessagesTitle(f):(a.removeFavicon(0),i.resetTitle()))}function b(){h=!0,a.registerFavicon(0),i.setTitle(o["new.message.title"],"* * * * * * * * * * * *"),d&&clearTimeout(d),d=setTimeout((function(){h=!1,y()}),5e3)}function w(e,t){e.forEach((function(e){!function(e){var t=Date.now(),n=g.some((function(n,r){return t-e.time>6e4&&g.splice(r,1),e.msgId===n.msgId}));return n||(e.time=t,g.push(e)),n}(e)?n.show(e.title,e.body,e.icon,e.convId,(function(){n.closeAll(),window.focus(),t?require(["OK/messages2/layer"],(function(t){t&&t.open(e.url)})):require(["OK/messages/MessagesLayer"],(function(t){t.open({conversationId:e.convId})}))})):u.success("html5.ntf.filter")}))}return{activate:function(t){e.activate(t);var n,i=this;r.register({name:"alert",priority:r.priority.medium,dependsOn:"convMgt_newMsg",applyNews:function(e){return i.applyNews(e)}}),n=p(),f=n.initialConvCount,n.initialMsgCount>0&&f>0&&!n.user.isStar&&b()},applyNews:function(e){var t=e&&e.alerts;if(!t)return!1;var r=t.notifications,i=function(e){if(!s.isLayerOpenedAndActive())return!0;if(require.defined("OK/messages/ConversationsManager")){var t,n,r=require("OK/messages/ConversationsManager");for(t=0;t<e.length;t++)if(!(n=r.getById(e[t]))||!n.selected)return!0;return!1}return!0}(t.subscribedConvIds),a=r&&r.length&&i;try{!function(e){var t=p().user,n=!e&&s.isLayerOpenedAndActive();t.isPlaySound&&m()&&!n&&v()}(i)}catch(e){u.error("messagesLayer.error","playSound")}return a&&(f=e.unreadCount?e.unreadCount.conv:0,b()),function(e){e.length>0&&!s.isWindowHasFocus()&&n.isEnabled()&&l.isMaster()&&w(e)}(r),!0},updateUnread:function(e,t){f=e,t&&f>0&&b(),y()},playSoundTT:function(){m()&&v()},showNotificationsTT:function(e){!s.isWindowHasFocus()&&n.isPermitionGranted()&&m()&&w(e,!0)},toggleSound:function(e){p().user.isPlaySound=e,e&&v()}}})),define("OK/messages/Timing",["OK/logger"],(function(e){"use strict";var t="OK/messages2/timing",n=require.defined(t),r={};return{log:function(i){if(!r.hasOwnProperty(i)){var a;if("start"==i)a=performance.now();else{var o=r.start;if(!o)return void e.success("messagesLayer","loading.ok.error");a=performance.now()-o}r[i]=a,e.durationScalar("messagesLayer","loading.ok."+i,a),function(e){n&&require([t],(function(t){t.log("flback-"+e)}))}(i)}}}})),define("OK/messages/MessagesToggleButton",["OK/logger","OK/messages/Timing","OK/ToolbarBubble"],(function(e,t,n){"use strict";var r="click",i=n.wrap("counter_ToolbarMessages");function a(n){var r=this;n.preventDefault(),n.stopPropagation(),t.log("start"),OK.loader.execRequire("OK/messages/MessagesLayer",(function(t){if("msg_toolbar_button"===r.id&&!t.isOpen()){var n=i.hasReply()?"reply":i.getCount();e.success("messagesLayer","open",n)}t.toggle()}))}return{activate:function(e){e.addEventListener(r,a)},deactivate:function(e){e.removeEventListener(r,a)}}})),
/*! FileAPI 2.0.3n18 - BSD | git://github.com/mailru/FileAPI.git
 * FileAPI — a set of  javascript tools for working with files. Multiupload, drag'n'drop and chunked file upload. Images: crop, resize and auto orientation by EXIF.
 */
define("FileAPI",["OK/logger"],(function(e){function t(){return document.createElement("canvas")}var n=function(t){e.success("fileapi.calls",t)},r=function(t,n){e.success("fileapi.flags",t,n)},i=!1;try{i=t().toDataURL("image/jpeg",.9).indexOf("data:image/jpeg")>-1}catch(e){}return r("qualitySupported",i),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,i,o,s,l,u;for(FileAPI.log("DataURI to blob called",e.length),t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),i=new ArrayBuffer(t.length),o=new Uint8Array(i),s=0;s<t.length;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?(FileAPI.log("Using blob constructor",l,r,o.length,i.byteLength),new Blob([r?o:i],{type:l})):(FileAPI.log("Using blob constructor",l,i.byteLength),(u=new a).append(i),u.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){i&&r&&t.toDataURL&&o?e(o(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e){"use strict";var t=e.require.s.contexts._.config.config.FileAPI,n=!!e.createObjectURL||!(!e.URL||!e.URL.revokeObjectURL)||!!e.webkitURL,a=!(!e.HTMLCanvasElement||!e.HTMLCanvasElement.prototype.toBlob),o=e.okFlashVersion,s=o&&3===o.length&&(o[0]>10||10===o[0]&&o[1]>=0),l=n&&a&&i;r("isSuitableFlashVersion",s),r("isEffectiveImageUploadSupported",a),r("isURLSupported",n),r("useHtml5",l),e.FileAPI={debug:t.debug,cors:!0,multiPassResize:!0,uploadRetry:3,imageOrientation:t.imageOrientation,staticPath:t.staticPath,flashAbortTimeout:36e5,flashEagerLoad:s,flashEnabled:s,withCredentials:!1,checkBlack:!0,html5:l||function(t){return"video/*"===t.accept||l&&!!e.FileAPI.support.apiURL},html5ExceptPhoto:function(e){return"video/*"===e.accept}}}(window),function(e,t){"use strict";var i=1,a=function(){},o=e.document,s=o.doctype||{},l=e.navigator.userAgent,u=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL;r("apiURL",!!u);var f=e.Blob,c=e.File,d=e.FileReader,h=e.FormData,g=e.XMLHttpRequest,p=e.jQuery,m=!(!(c&&d&&(e.Uint8Array||h||g.prototype.sendAsBinary))||/safari\//i.test(l)&&!/chrome\//i.test(l)&&/windows/i.test(l));r("html5",m);var v=m&&"withCredentials"in new g;r("cors",v);var y=m&&!!f&&!!(f.prototype.webkitSlice||f.prototype.mozSlice||f.prototype.slice),b=e.dataURLtoBlob,w=/img/i,I=/canvas/i,E=/img|canvas/i,A=/input/i,P=/^data:[^,]+,/,S=e.Math,O=function(t){return(t=new e.Number(S.pow(1024,t))).from=function(e){return S.round(e*this)},t},T={},C=[],x="abort progress error load loadend",L="status statusText readyState response responseXML responseText responseBody".split(" "),D=function(e){return e&&"length"in e},F=function(e,t,n){if(e)if(D(e))for(var r=0,i=e.length;r<i;r++)r in e&&t.call(n,e[r],r,e);else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a,e)},_=function(e){for(var t=arguments,n=1,r=function(t,n){e[n]=t};n<t.length;n++)F(t[n],r);return e},R=function(e,t,r){if(e){var i=N.uid(e);T[i]||(T[i]={});var a=d&&e&&e instanceof d;F(t.split(/\s+/),(function(t){p&&!a?(n("jQuery.event.add"),p.event.add(e,t,r)):(T[i][t]||(T[i][t]=[]),T[i][t].push(r),e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r)}))}},B=function(e,t,n){if(e){var r=N.uid(e),i=T[r]||{},a=d&&e&&e instanceof d;F(t.split(/\s+/),(function(t){if(p&&!a)p.event.remove(e,t,n);else{for(var r=i[t]||[],o=r.length;o--;)if(r[o]===n){r.splice(o,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}}))}},U=function(e,t,n){R(e,t,(function r(i){B(e,t,r),n(i)}))},k=function(t){return t.target||(t.target=e.event&&e.event.srcElement||o),3===t.target.nodeType&&(t.target=t.target.parentNode),t},M=function(e){var t=o.createElement("input");return t.setAttribute("type","file"),e in t},N={version:"2.0.3n18",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,trace:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,flashEagerLoad:!1,flashEnabled:!0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:O(1),MB:O(2),GB:O(3),TB:O(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[N.expando]=e[N.expando]||N.uid():(++i,N.expando+i)},log:function(){function t(e){return e.length>1?e:"0"+e}if(N.debug&&e.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," "))),N.isArray(N.trace)){var n=new Date,r=n.getHours(),i=n.getMinutes(),a=n.getSeconds();N.trace.push("["+t(r)+":"+t(i)+":"+t(a)+"]: "+[].join.call(arguments," "))}},startTrace:function(){N.trace=[]},stopTrace:function(){N.trace=!1},getTrace:function(){return N.isArray(N.trace)?N.trace:[]},newImage:function(e,t){var n=o.createElement("img");return t&&N.event.one(n,"error load",(function(e){t("error"==e.type,n),n=null})),n.src=e,n},getXHR:function(){var t;if(g)t=new g;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:D,support:{dnd:v&&"ondrop"in o.createElement("div"),cors:v,html5:m,chunked:y,dataURI:!0,apiURL:!!u,accept:M("accept"),multiple:M("multiple")},event:{on:R,off:B,one:U,fix:k},throttle:function(t,n){var r,i;return function(){i=arguments,r||(t.apply(e,i),r=setTimeout((function(){r=0,t.apply(e,i)}),n))}},F:function(){},parseJSON:function(t){return e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return(e=String(e)).trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,r=[],i={resolve:function(t,o){for(i.resolve=a,n=t||!1,e=o;o=r.shift();)o(n,e)},then:function(i){n!==t?i(n,e):r.push(i)}};return i},isDeferred:function(e){return e&&"function"==typeof e.then&&"function"==typeof e.resolve},queue:function(e){var t=0,n=0,r=!1,i=!1,a={inc:function(){n++},next:function(){t++,setTimeout(a.check,0)},check:function(){t>=n&&!r&&a.end()},isFail:function(){return r},fail:function(t){!r&&e(r=t||!0)},end:function(){i||(i=!0,e())}};return a},each:F,afor:function(e,t){var n=0,r=e.length;D(e)&&r--?function i(){t(r!=n&&i,e[n],n++)}():t(!1)},extend:_,isFile:function(e){return m&&e&&e instanceof c},isBlob:function(e){return m&&e&&e instanceof f},isCanvas:function(e){return e&&I.test(e.nodeName)},getFilesFilter:function(e){return(e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"")?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){N.log("api.readAsDataUrl"),N.isCanvas(e)?H(e,t,"load",N.toDataURL(e)):j(e,t,"DataURL")},readAsBinaryString:function(e,t){N.log("api.readAsBinaryString"),K("BinaryString")?j(e,t,"BinaryString"):j(e,(function(e){if("load"==e.type)try{e.result=N.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}t(e)}),"DataURL")},readAsArrayBuffer:function(e,t){j(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),j(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(N.toDataURL(t).replace(P,""))},readAsImage:function(e,n,r){if(N.isFile(e))if(N.log("readAsImage.isFile"),u){N.log("readAsImage.apiURL");var i=u.createObjectURL(e);i===t?H(e,n,"error"):(N.log("readAsImage.apiURL.create url = "+i),N.readAsImage(i,n,r))}else N.log("readAsImage.dataURL"),N.readAsDataURL(e,(function(t){"load"==t.type?N.readAsImage(t.result,n,r):(r||"error"==t.type)&&H(e,n,t,null,{loaded:t.loaded,total:t.total})}));else if(N.isCanvas(e))N.log("readAsImage.isCanvas"),H(e,n,"load",e);else if(w.test(e.nodeName))if(N.log("readAsImage.isImg"),e.complete)N.log("readAsImage.isImg.completed"),H(e,n,"load",e);else{N.log("readAsImage.isImg.pending");var a,o="error abort load",s=!1,l=function(t){N.log("readAsImage.isImg.callback."+t.type),s||(s=!0,"load"==t.type&&u&&(N.log("readAsImage.isImg.revoke url = "+e.src),u.revokeObjectURL(e.src)),a&&(clearTimeout(a),a=null),B(e,o,l),H(e,n,t,e))};U(e,o,l),a=setTimeout((function(){a=null,e.complete&&(N.log("readAsImage.isImg.timeout"),l({type:"load"}))}),500)}else if(e.iframe)N.log("readAsImage.isIFrame"),H(e,n,{type:"error"});else{N.log("readAsImage.else");var f=N.newImage(e.dataURL||e);N.log("readAsImage.else.newImage"),setTimeout((function(){N.log("readAsImage.else.timeout"),N.readAsImage(f,n,r)}),0)}},checkFileObj:function(e){var t={},n=N.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),F(n,(function(e,n){((e=new RegExp(e.replace(/\s/g,"|"),"i")).test(t.type)||N.ext2mime[t.type])&&(t.type=N.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)})),t},getDropFiles:function(e,t){var n=[],r=q(e),i=D(r.items)&&r.items[0]&&G(r.items[0]),a=N.queue((function(){t(n)}));F((i?r.items:r.files)||[],(function(e){a.inc();try{i?z(e,(function(e,t){e?N.log("[err] getDropFiles:",e):n.push.apply(n,t),a.next()})):function(e,t){if(!e.type&&e.size%4096==0&&e.size<=102400)if(d)try{var n=new d;U(n,x,(function(e){var r="error"!=e.type;t(r),r&&n.abort()})),n.readAsDataURL(e)}catch(e){t(!1)}else t(null);else t(!0)}(e,(function(t){t&&n.push(e),a.next()}))}catch(e){a.next(),N.log("[err] getDropFiles: ",e)}})),a.check()},getFiles:function(e,t,n){var r=[];return n?(N.filterFiles(N.getFiles(e),t,n),null):(e.jquery&&(e.each((function(){r=r.concat(N.getFiles(this))})),e=r,r=[]),"string"==typeof t&&(t=N.getFilesFilter(t)),e.originalEvent?e=k(e.originalEvent):e.srcElement&&(e=k(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(r=e.files,m||(r[0].blob=e,r[0].iframe=!0)):!m&&W(e)?N.trim(e.value)&&((r=[N.checkFileObj(e.value)])[0].blob=e,r[0].iframe=!0):D(e)&&(r=e),N.filter(r,(function(e){return!t||t.test(e.name)})))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},r=C.concat();N.isFile(e)?function i(){var a=r.shift();N.log("Reader shifted"),a?(N.log("Reader found"),a.test(e.type)?(N.log("Reader matched"),a(e,(function(e,r){N.log("Reader callback"),e?(N.log("Reader err"),t(e)):(N.log("Reader suc"),_(n,r),i())}))):(N.log("Reader skipped"),i())):(N.log("Readers none"),t(!1,n))}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},C.push(t)},filter:function(e,t){for(var n,r=[],i=0,a=e.length;i<a;i++)i in e&&(n=e[i],t.call(n,n,i,e)&&r.push(n));return r},filterFiles:function(e,t,n){if(e.length){var r,i=e.concat(),a=[],o=[];!function e(){i.length?(r=i.shift(),N.getInfo(r,(function(n,i){(t(r,!n&&i)?a:o).push(r),e()}))):n(a,o)}()}else n([],e)},upload:function(e){(e=_({jsonp:"callback",prepare:N.F,beforeupload:N.F,upload:N.F,fileupload:N.F,fileprogress:N.F,filecomplete:N.F,progress:N.F,complete:N.F,pause:N.F,imageOriginal:!0,chunkSize:N.chunkSize,chunkUploadRetry:N.chunkUploadRetry,retryDelay:N.networkDownRetryTimeout,uploadRetry:N.uploadRetry},e)).imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new N.XHR(e),r=this._getFilesDataArray(e.files),i=this,o=0,s=0,l=!1;return F(r,(function(e){o+=e.size})),n.files=[],F(r,(function(e){n.files.push(e.file)})),n.total=o,n.loaded=0,n.filesLeft=r.length,e.beforeupload(n,e),t=function(){var u,f=r.shift(),c=f&&f.file,d=!1,h=(u={},F(e,(function(e,t){e&&"object"==typeof e&&void 0===e.nodeType&&(e=_({},e)),u[t]=e})),u);if(n.filesLeft=r.length,c&&c.name===N.expando&&(c=null,N.log("[warn] FileAPI.upload() — called without files")),("abort"!=n.statusText||n.current)&&f){l=!1,n.currentFile=c,h.file=c,N.log("Preparing file to upload");var g=c&&e.prepare(c,h);if(!1===g)N.log("Skipping file"),t.call(i);else{var p=function(){N.log("Getting formData for the file"),i._getFormData(h,f,(function(l){N.log("Got formData for the file"),s||e.upload(n,e),N.log("Preparing XHR for the file");var u=new N.XHR(_({},h,{upload:c?function(){e.fileupload(c,u,h)}:a,progress:c?function(t){d||0===t.total||(d=t.loaded===t.total,e.fileprogress({type:"progress",total:f.total=t.total,loaded:f.loaded=t.loaded},c,u,h),e.progress({type:"progress",total:o,loaded:n.loaded=s+f.size*(t.loaded/t.total)|0},c,u,h))}:a,complete:function(r){N.log("Completed XHR for the file"),F(L,(function(e){n[e]=u[e]})),c&&(f.total=f.total||f.size,f.loaded=f.total,this.progress(f),d=!0,s+=f.size,n.loaded=s,e.filecomplete(r,u,c,h)),setTimeout((function(){t.call(i)}),0)}}));n.abort=function(e){e||(r.length=0),this.current=e,u.abort()},N.log("Sending XHR for the file"),u.send(l),N.log("Sent XHR for the file")}))};N.isDeferred(g)?g.then((function(e,n){!1!==n?(N.log("Prepared file"),p()):(N.log("Skipping file 2"),t.call(i))})):p()}}else e.complete(200!=n.status&&201!=n.status&&(n.statusText||"error"),n,e),l=!0},setTimeout(t,0),n.append=function(e,a){e=N._getFilesDataArray([].concat(e)),F(e,(function(e){o+=e.size,n.files.push(e.file),a?r.unshift(e):r.push(e)})),n.statusText="",l&&t.call(i)},n.remove=function(e){for(var t,n=r.length;n--;)r[n].file==e&&(t=r.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(W(e)){var r=N.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?r:r[0]}else D(e)&&W(e[0])?F(e,(function(e){n[e.name||"file"]=N.getFiles(e)})):n=e;return F(n,(function e(n,r){D(n)?F(n,(function(t){e(t,r)})):n&&(n.name||n.image)&&t.push({name:r,file:n,size:n.size,total:n.size,loaded:0})})),t.length||t.push({file:{name:N.expando}}),t},_getFormData:function(e,t,n){var r=t.file,i=t.name,a=r.name,o=r.type,s=N.support.transform&&e.imageTransform,u=new N.Form,f=N.queue((function(){n(u)})),c=s&&function(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}(s),d=N.postNameConcat;!function t(n){if(n.image)f.inc(),n.toData((function(e,n){a=a||(new Date).getTime()+".png",t(n),f.next()}));else if(N.Image&&s&&(/^image/.test(n.type)||E.test(n.nodeName))){f.inc(),c&&(s=[s]);var r=/android 4/i.test(l),h=(!b||r)&&!N.flashEngine;N.log("Transforming with"+(h?"":"out")+" multipart"),N.Image.transform(n,s,e.imageAutoOrientation,(function(t,r){if(c&&!t)h&&(u.multipart=!0),u.append(i,r[0],a,s[0].type||o);else{var l=0;t||F(r,(function(e,t){h&&(N.log("Using multipart"),u.multipart=!0),s[t].postName||(l=1),u.append(s[t].postName||d(i,t),e,a,s[t].type||o)})),(t||e.imageOriginal)&&(t&&(N.log("Fallback to original image because of error"),n.__fails=n.__fails||{},n.__fails.tx=n.__fails.tx||[],n.__fails.tx.push(t)),u.append(d(i,l?"original":null),n,a,o))}f.next()}))}else a!==N.expando&&u.append(i,n,a);e.attachExif&&N.getInfo(n,(function(e,t){var n=!e&&t&&t.exif&&t.exif.V2&&t.exif.toString();n&&u.append("exif",n)}))}(r),F(e.data,(function e(t,n){"object"==typeof t?F(t,(function(t,r){e(t,d(n,r))})):u.append(n,t)})),f.check()},reset:function(e,t){var n,r;return p?(r=p(e).clone(!0).insertBefore(e).val("")[0],t||p(e).remove()):(n=e.parentNode,(r=n.insertBefore(e.cloneNode(!0),e)).value="",t||n.removeChild(e),F(T[N.uid(e)],(function(t,n){F(t,(function(t){B(e,n,t),R(r,n,t)}))}))),r},load:function(e,t){var n=N.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),R(n,"progress",(function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)})),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){var r={name:(e=e.split("/"))[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};r.dataURL="data:"+r.type+";base64,"+N.encode64(n.responseBody||n.responseText),t({type:"load",result:r},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",r=0;for("string"!=typeof e&&(e=String(e));r<e.length;){var i,a,o=255&e.charCodeAt(r++),s=255&e.charCodeAt(r++),l=255&e.charCodeAt(r++),u=o>>2,f=(3&o)<<4|s>>4;isNaN(s)?i=a=64:(i=(15&s)<<2|l>>6,a=isNaN(l)?64:63&l),n+=t.charAt(u)+t.charAt(f)+t.charAt(i)+t.charAt(a)}return n}};function H(e,t,n,r,i){var a={type:n.type||n,target:e,result:r};_(a,i),t(a)}function K(e){return d&&!!d.prototype["readAs"+e]}function j(e,n,r,i){if(N.isBlob(e)&&K(r)){var a=new d,o=0;N.log("readAs"+r+" [Start]"),R(a,x,(function t(i){var s=i.type;if("progress"==s){N.log("readAs"+r+" [Progress]");var l=Date.now();l-o>400&&(o=l,H(e,n,i,i.target.result,{loaded:i.loaded,total:i.total}))}else"loadend"==s?(N.log("readAs"+r+" [End]"),B(a,x,t),a=null):H(e,n,i,i.target.result)}));try{i?a["readAs"+r](e,i):a["readAs"+r](e)}catch(r){H(e,n,"error",t,{error:r.toString()})}}else H(e,n,"error",t,{error:"filreader_not_support_"+r})}function G(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function z(e,t){if(e)if(e.isFile)e.file((function(n){n.fullPath=e.fullPath,t(!1,[n])}),(function(e){t("FileError.code: "+e.code)}));else if(e.isDirectory){var n=e.createReader(),r=[];n.readEntries((function(e){N.afor(e,(function(e,n){z(n,(function(n,i){n?N.log(n):r=r.concat(i),e?e():t(!1,r)}))}))}),(function(e){t("directory_reader: "+e)}))}else z(G(e),t);else t("invalid entry")}function W(e){return A.test(e&&e.tagName)}function q(e){return(e.originalEvent||e||"").dataTransfer||{}}N.addInfoReader(/^image/,(function(e,t){if(N.log("Dimension reader started"),e.__dimensions)N.log("Dimension reader already done");else{var n=e.__dimensions=N.defer();N.log("Dimension reader readAsImage"),N.readAsImage(e,(function(e){var t=e.target;N.log("Dimension reader readAsImage.callback"),n.resolve("load"!=e.type&&"error",{width:t.width,height:t.height}),t.src=N.EMPTY_PNG,t=null}))}e.__dimensions.then(t)})),N.event.dnd=function(e,t,n){var r,i;n||(n=t,t=N.F),d?(R(e,"dragenter dragleave dragover",(function(e){for(var n=q(e).types,a=n&&n.length,o=!1;a--;)if(~n[a].indexOf("File")){e.preventDefault(),i!==e.type&&("dragleave"!=(i=e.type)&&t.call(e.currentTarget,!0,e),o=!0);break}o&&(clearTimeout(r),r=setTimeout((function(){t.call(e.currentTarget,"dragleave"!=i,e)}),50))})),R(e,"drop",(function(e){e.preventDefault(),i=0,t.call(e.currentTarget,!1,e),N.getDropFiles(e,(function(t){n.call(e.currentTarget,t,e)}))}))):N.log("Drag'n'Drop -- not supported")},N.event.dnd.off=function(e,t,n){B(e,"dragenter dragleave dragover",t),B(e,"drop",n)},p&&!p.fn.dnd&&(p.fn.dnd=function(e,t){return n("jQuery.fn.dnd"),this.each((function(){n("jQuery.dnd"),N.event.dnd(this,e,t)}))},p.fn.offdnd=function(e,t){return this.each((function(){N.event.dnd.off(this,e,t)}))}),e.FileAPI=_(N,e.FileAPI),N.log("FileAPI: "+N.version),N.log("protocol: "+e.location.protocol),N.log("doctype: ["+s.name+"] "+s.publicId+" "+s.systemId),F(o.getElementsByTagName("meta"),(function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&N.log("meta.http-equiv: "+e.getAttribute("content"))})),N.flashUrl||(N.flashUrl=N.staticPath+"FileAPI"+(N.debug?".debug":"")+".flash.swf"),N.flashImageUrl||(N.flashImageUrl=N.staticPath+"FileAPI.flash.image.swf"),N.flashWebcamUrl||(N.flashWebcamUrl=N.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,n,r){"use strict";var i=Math.min,a=Math.round,o=!1,s=!1,l={8:270,3:180,6:90};try{o=t().toDataURL("image/png").indexOf("data:image/png")>-1}catch(e){}try{s=t().toDataURL("image/webp").indexOf("data:image/webp")>-1}catch(e){}function u(e){for(var t=0,n=0;n<e.length;n+=4)(e[n]||e[n+1]||e[n+2])&&t++;return t}function f(t){if(t instanceof f){var n=new f(t.file);return e.extend(n.matrix,t.matrix),n}if(!(this instanceof f))return new f(t);this.file=t,this.size=t.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}f.prototype={image:!0,constructor:f,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,n,i){return n===r&&(n=e,i=t,e=t=0),this.set({sx:e,sy:t,sw:n,sh:i||n})},resize:function(e,t,n){return/min|max/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new f(this)},_load:function(t,n){var r=this;/img|video/i.test(t.nodeName)?n.call(r,null,t):e.readAsImage(t,(function(e){n.call(r,"load"!=e.type,e.result)}))},_apply:function(n,r){var a,o=t(),s=this.getMatrix(n),l=o.getContext("2d"),c=n.videoWidth||n.width,d=n.videoHeight||n.height,h=s.deg,g=s.dw,p=s.dh,m=c,v=d,y=s.filter,b=n,w=s.overlay,I=e.queue((function(){n.src=e.EMPTY_PNG,r(!1,o)})),E=e.renderImageToCanvas;for(n._type=this.file.type;s.multipass&&i(m/g,v/p)>2;)m=m/2+.5|0,v=v/2+.5|0,(a=t()).width=m,a.height=v,b!==n?(E(a,b,0,0,b.width,b.height,0,0,m,v),b=a):(E(b=a,n,s.sx,s.sy,s.sw,s.sh,0,0,m,v),s.sx=s.sy=s.sw=s.sh=0);if(o.type=s.type,o.quality=s.quality,void 0===o.style.imageOrientation&&!window.FileAPI.imageOrientation||(h=0),o.width=h%180?p:g,o.height=h%180?g:p,l.rotate(h*Math.PI/180),E(l.canvas,b,s.sx,s.sy,s.sw||b.width,s.sh||b.height,180==h||270==h?-g:0,90==h||180==h?-p:0,g,p),g=o.width,p=o.height,e.checkBlack&&"function"==typeof l.getImageData&&g>1&&p>1){var A=!1;try{if(u(l.getImageData(Math.max(g/2-10,0),Math.max(p/2-10,0),Math.min(g/2+10,g),Math.min(p/2+10,p)).data)<3)A=u(l.getImageData(0,0,g,g).data)<3}catch(t){e.log("Exception while detecting black picture",t.name,t.message)}if(A)throw e.log("Found absolutely black picture",c,d,g,p,h),"AbsolutelyBlackImg"}w&&e.each([].concat(w),(function(t){I.inc();var n=new window.Image,r=function(){var i=0|t.x,a=0|t.y,o=t.w||n.width,s=t.h||n.height,u=t.rel;i=1==u||4==u||7==u?(g-o+i)/2:2==u||5==u||8==u?g-(o+i):i,a=3==u||4==u||5==u?(p-s+a)/2:u>=6?p-(s+a):a,e.event.off(n,"error load abort",r);try{l.globalAlpha=t.opacity||1,l.drawImage(n,i,a,o,s)}catch(e){}I.next()};e.event.on(n,"error load abort",r),n.src=t.src,n.complete&&r()})),y&&(I.inc(),f.applyFilter(o,y,I.next)),I.check()},getMatrix:function(t){var n,r,o=e.extend({},this.matrix),s=o.sw=o.sw||t.videoWidth||t.naturalWidth||t.width,l=o.sh=o.sh||t.videoHeight||t.naturalHeight||t.height,u=o.dw=o.dw||s,f=o.dh=o.dh||l,c=s/l,d=u/f,h=o.resize;"preview"==h?u==s&&f==l||(d>=c?r=(n=s)/d:n=(r=l)*d,n==s&&r==l||(o.sx=~~((s-n)/2),o.sy=~~((l-r)/2),s=n,l=r)):h&&(s>u||l>f?"min"==h?(u=a(c<d?i(s,u):i(l,f)*c),f=a(c<d?u/c:i(l,f))):(u=a(c>=d?i(s,u):i(l,f)*c),f=a(c>=d?u/c:i(l,f))):(u=s,f=l));return o.sw=s,o.sh=l,o.dw=u,o.dh=f,o.multipass=e.multiPassResize,o},_trans:function(t){this._load(this.file,(function(n,r){if(n)t(n);else try{this._apply(r,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}}))},get:function(t){if(e.support.transform){var n=this,r=n.matrix;"auto"==r.deg?e.getInfo(n.file,(function(e,i){r.deg=l[i&&i.exif&&i.exif.Orientation]||0,n._trans(t)})):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},f.exifOrientation=l,f.transform=function(t,n,i,a){function o(o,s){var l={},u=e.queue((function(e){a(e,l)}));e.log("Image._transform"),o?u.fail(o):(e.log("Image._transform !err"),e.each(n,(function(n,a){if(e.log("Image._transform @"+a+"@each: "+u.isFail()),!u.isFail()){var o=new f(s.nodeType?s:t);if("function"==typeof n?n(s,o):n.width?o[n.preview?"preview":"resize"](n.width,n.height,n.strategy):n.maxWidth&&(s.width>n.maxWidth||s.height>n.maxHeight)&&o.resize(n.maxWidth,n.maxHeight,"max"),n.crop){var c=n.crop;o.crop(0|c.x,0|c.y,c.w||c.width,c.h||c.height)}n.rotate===r&&i&&(n.rotate="auto"),o.set({deg:n.rotate,type:n.type||t.type||"image/png",quality:n.quality||1,overlay:n.overlay,filter:n.filter}),u.inc(),e.log("Image._transform before toData"),o.toData((function(t,n){e.log("Image._transform after toData ["+t+"]"),t?u.fail(t):(l[a]=n,u.next())}))}})))}t.width?o(!1,t):e.getInfo(t,o)},e.each(["TOP","CENTER","BOTTOM"],(function(t,n){e.each(["LEFT","CENTER","RIGHT"],(function(e,r){f[t+"_"+e]=3*n+r,f[e+"_"+t]=3*n+r}))})),f.toCanvas=function(e){var n=t();return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},f.fromDataURL=function(t,n,r){var i=e.newImage(t);e.extend(i,n),r(i)},f.applyFilter=function(t,n,r){"function"==typeof n?n(t,r):window.Caman&&window.Caman("IMG"==t.tagName?f.toCanvas(t):t,(function(){"string"==typeof n?this[n]():e.each(n,(function(e,t){this[t](e)}),this),this.render(r)}))},e.renderImageToCanvas=function(t,n,r,i,a,o,s,l,u,f){try{return t.getContext("2d").drawImage(n,r,i,a,o,s,l,u,f)}catch(t){throw e.log("renderImageToCanvas failed"),t}},e.support.canvas=e.support.transform=o,e.support.webp=s,e.Image=f}(FileAPI,document),function(e){"use strict";!function(e){if(!window.navigator||!window.navigator.platform||!/iP(hone|od|ad)/.test(window.navigator.platform))return;var n=e.renderImageToCanvas;e.detectSubsampling=function(e){var n,r;return e.width*e.height>1048576&&((n=t()).width=n.height=1,(r=n.getContext("2d")).drawImage(e,1-e.width,0),0===r.getImageData(0,0,1,1).data[3])},e.detectVerticalSquash=function(e,n){var r,i,a,o,s=e.naturalHeight||e.height,l=t(),u=l.getContext("2d");for(n&&(s/=2),l.width=1,l.height=s,u.drawImage(e,0,0),r=u.getImageData(0,0,1,s).data,i=0,a=s,o=s;o>i;)0===r[4*(o-1)+3]?a=o:i=o,o=a+i>>1;return o/s||1},e.renderImageToCanvas=function(r,i,a,o,s,l,u,f,c,d){if("image/jpeg"===i._type){var h,g,p,m,v=r.getContext("2d"),y=t(),b=1024,w=y.getContext("2d");if(y.width=b,y.height=b,v.save(),(h=e.detectSubsampling(i))&&(a/=2,o/=2,s/=2,l/=2),g=e.detectVerticalSquash(i,h),h||1!==g){for(o*=g,c=Math.ceil(b*c/s),d=Math.ceil(b*d/l/g),f=0,m=0;m<l;){for(u=0,p=0;p<s;)w.clearRect(0,0,b,b),w.drawImage(i,a,o,s,l,-p,-m,s,l),v.drawImage(y,0,0,b,b,u,f,c,d),p+=b,u+=c;m+=b,f+=d}return v.restore(),r}}return n(r,i,a,o,s,l,u,f,c,d)}}(FileAPI)}(),function(e,t){"use strict";var n=t.document,r=t.FormData,i=function(){this.items=[]},a=t.encodeURIComponent;function o(t,n,r){var i=t.blob,a=t.file;if(e.log("_convertFile",a,r),a){if(!i.toDataURL)return void e.readAsBinaryString(i,(function(e){"load"==e.type&&n(t,e.result)}));var o={"image/jpeg":".jpe?g","image/png":".png"},s=o[t.type]?t.type:"image/png",l=o[s]||".png",u=i.quality||1;a.match(new RegExp(l+"$","i"))||(a+=l.replace("?","")),t.file=a,t.type=s,!r&&i.toBlob?i.toBlob((function(e){n(t,e)}),s,u):n(t,e.toBinaryString(i.toDataURL(s,u)))}else n(t,i)}i.prototype={append:function(e,t,n,r){this.items.push({name:e,blob:t&&t.blob||(null==t?"":t),file:t&&(n||t.name),type:t&&(r||t.type)})},each:function(e){for(var t=0,n=this.items.length;t<n;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,(function(e){return e.file})).length,e.support.html5?e.formData&&!this.multipart&&r?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,r,i){var a=e.queue((function(){n(t)}));this.each((function(e){r(e,t,a,i)})),a.check()},toHtmlData:function(t){this._to(n.createDocumentFragment(),t,(function(t,r){var i,a=t.blob;t.file?(e.reset(a,!0),a.name=t.name,r.appendChild(a)):((i=n.createElement("input")).name=t.name,i.type="hidden",i.value=a,r.appendChild(i))}))},toPlainData:function(e){this._to({},e,(function(e,t,n){e.file&&(t.type=e.file),e.blob.toBlob?(n.inc(),o(e,(function(e,r){t.name=e.name,t.file=r,t.size=r.length||r.size,t.type=e.type,n.next()}))):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(a(e.name)+"="+a(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0}))},toFormData:function(t){this._to(new r,t,(function(t,n,r){t.blob&&t.blob.toBlob?(e.log("FileAPI.Form.toFormData Blob",typeof t,typeof t.blob,t.blob.tagName),r.inc(),o(t,(function(t,i){e.log("FileAPI.Form.toFormData after convert",typeof i,i.constructor.name),n.append(t.name,i,t.file),r.next()}))):t.file?(e.log("FileAPI.Form.toFormData File",typeof t,typeof t.blob),n.append(t.name,t.blob,t.file)):(e.log("FileAPI.Form.toFormData Other",typeof t,typeof t.blob),n.append(t.name,t.blob)),t.file&&(e.log("FileAPI.Form.toFormData _file",typeof t,typeof t.blob),n.append("_"+t.name,t.file))}))},toMultipartData:function(t){this._to([],t,(function(e,t,n,r){n.inc(),o(e,(function(e,i){t.push("--_"+r+'\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+a(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?i:a(i))+"\r\n"),n.next()}),!0)}),e.expando)}},e.Form=i}(FileAPI,window),function(e,t){"use strict";var n=function(){},r=e.document,i=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},a={"":1,XML:1,Text:1,Body:1};i.prototype={status:0,statusText:"",constructor:i,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(r,i){var a=this,o=a.options;a.end=a.abort=n,a.status=r,i&&(a.statusText=i),t.log("xhr.end:",r,i),o.complete(200!=r&&201!=r&&(a.statusText||"unknown"),a),a.xhr&&a.xhr.node&&setTimeout((function(){var t=a.xhr.node;try{t.parentNode.removeChild(t)}catch(e){}try{delete e[a.uid]}catch(e){}e[a.uid]=a.xhr.node=null}),9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData((function(e){n.upload(n,t),t._send.call(t,n,e)}),n)},_send:function(n,i){var o,s=this,l=s.uid,u=n.url;if(t.log("XHR._send:",typeof i),n.cache||(u+=(~u.indexOf("?")?"&":"?")+t.uid()),i.nodeName){t.log("XHR.iframe upload");var f=n.jsonp;u=u.replace(/([a-z]+)=(\?)/i,"$1="+l),(o=r.createElement("div")).innerHTML='<form target="'+l+'" action="'+u+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;"></iframe>'+(f&&n.url.indexOf("=?")<0?'<input value="'+l+'" name="'+f+'" type="hidden"/>':"")+"</form>";var c=o.getElementsByTagName("form")[0],d=o.getElementsByTagName("iframe")[0];c.appendChild(i),r.body.appendChild(o),s.xhr.node=o;var h=function(e){if(t.log("Post message received"),~u.indexOf(e.origin))try{t.log("Post message matches origin");var n=t.parseJSON(e.data);n.id==l&&(t.log("Post message matches id"),g(n.status,n.statusText,n.response))}catch(e){g(0,e.message)}},g=e[l]=function(n,r,i){s.readyState=4,s.responseText=i,s.end(n,r||"jsonp_empty"),t.event.off(e,"message",h),e[l]=o=d=d.onload=null,c=null};s.xhr.abort=function(){try{d.stop?d.stop():d.contentWindow.stop?d.contentWindow.stop():d.contentWindow.document.execCommand("Stop")}catch(e){}g(0,"abort")},t.event.on(e,"message",h);var p=0,m=100;d.onload=function(){try{t.log("Transport onload received");var e=d.contentWindow,n=e.document,r=e.result||t.parseJSON(n.body.innerHTML);if(!r&&p<30)return setTimeout(d.onload,Math.max(m+=m,2500)),void p++;g(r.status,r.statusText,r.response)}catch(e){t.log("[transport.onload]",e),g(0,"[transport.onload]")}},s.readyState=2,c.submit()}else{if(u=u.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(o=s.xhr=t.getXHR(),i.params&&(u+=(u.indexOf("?")<0?"?":"&")+i.params.join("&")),o.open("POST",u,!0),t.withCredentials&&(o.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,(function(e,t){o.setRequestHeader(t,e)})),n._chunked){o.upload&&o.upload.addEventListener("progress",t.throttle((function(e){i.retry||n.progress({type:e.type,total:i.size,loaded:i.start+e.loaded,totalSize:i.size},s,n)}),100),!1),o.onreadystatechange=function(){var e=parseInt(o.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var r in a)s["response"+r]=o["response"+r];if(o.onreadystatechange=null,!o.status||o.status-201>0)if(t.log("XHR Error: "+o.status),(!o.status&&!o.aborted||500==o.status||416==o.status)&&++i.retry<=n.chunkUploadRetry){var l=o.status?0:t.chunkNetworkDownRetryTimeout;n.pause(i.file,n),t.log("X-Last-Known-Byte: "+e),e?i.end=e:(i.end=i.start-1,416==o.status&&(i.end=i.end-n.chunkSize)),setTimeout((function(){s._send(n,i)}),l)}else s.end(o.status,"retr_exceeded");else i.retry=0,i.end==i.size-1?s.end(o.status):(t.log("X-Last-Known-Byte: "+e),e&&(i.end=e),i.file.FileAPIReadPosition=i.end,setTimeout((function(){s._send(n,i)}),0));o=null}},i.start=i.end+1,i.end=Math.max(Math.min(i.start+n.chunkSize,i.size)-1,i.start);var v=i.file,y=(v.slice||v.mozSlice||v.webkitSlice).call(v,i.start,i.end+1);i.size&&!y.size?setTimeout((function(){s.end(-1)})):(o.setRequestHeader("Content-Range","bytes "+i.start+"-"+i.end+"/"+i.size),o.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(i.name)),o.setRequestHeader("Content-Type","application/octet-stream"),o.send(y)),v=y=null}else if(o.upload&&o.upload.addEventListener("progress",t.throttle((function(e){n.progress(e,s,n)}),100),!1),o.onreadystatechange=function(){if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var e in a)s["response"+e]=o["response"+e];o.onreadystatechange=null,!o.status||o.status>201?(t.log("Error: "+o.status),(!o.status&&!o.aborted||500==o.status)&&(n.retry||0)<n.uploadRetry?(n.retry=(n.retry||0)+1,n.pause(n.file,n),setTimeout((function(){s._send(n,i)}),n.retryDelay)):s.end(o.status,o.aborted?void 0:o.statusText||"retr_exceeded")):s.end(o.status),o=null}},t.isArray(i)){o.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var b=i.join("")+"--_"+t.expando+"--";if(o.sendAsBinary)o.sendAsBinary(b);else{var w=Array.prototype.map.call(b,(function(e){return 255&e.charCodeAt(0)}));e.Uint8Array?o.send(new Uint8Array(w).buffer):setTimeout((function(){s.end(-2,"Unsupported Uint8Array")}))}}else o.send(i)}}},t.XHR=i}(window,FileAPI),function(e,t,i){"use strict";var a=e.document,o=e.location,s=e.navigator,l=i.each;i.support.flash=function(){var t=s.mimeTypes,n=!1;if(s.plugins&&"object"==typeof s.plugins["Shockwave Flash"])n=s.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{n=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){i.log("Flash -- does not supported.")}return n&&/^file:/i.test(o)&&i.log("[warn] Flash does not work on `file:` protocol."),r("flashSupported",n),n}(),i.flashInit=i.support.flash?function(){if(n("flashInit"),!i.Flash){var u=i.uid(),f=0,c={},d=/^https?:/i,h={_fn:{},readyState:0,init:function(e){n("flashInit.init");var t=a.body&&a.body.firstChild;if(h.readyState=1,t)do{if(1==t.nodeType){i.log("FlashAPI.state: awaiting"),h.readyState=2;var r=a.createElement("div");return r.id="_"+u,p(r,{top:e?e.top:1,right:e?e.right:1,width:e?e.width:5,height:e?e.height:5,position:"absolute",overflow:"hidden",zIndex:"1000000"}),t.parentNode.insertBefore(r,t),void h.publish(r,u)}}while(t=t.nextSibling);f<10&&setTimeout(h.init,50*++f)},publish:function(e,t,r){n("flashInit.publish"),r=r||{},h.readyState=3,e.innerHTML=g({id:t,width:2048,height:256,src:w(i.flashUrl,"r="+i.version),wmode:r.camera?"":"transparent",flashvars:"callback="+(r.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+s.userAgent.match(/\d/gi).join("")+"_"+i.version+(h.isReady||(i.pingUrl?"&ping="+i.pingUrl:""))+"&timeout="+i.flashAbortTimeout+(r.camera?"&useCamera="+w(i.flashWebcamUrl):"")+"&debug="+(i.debug?"1":"")}),h.readyState=4,i.flashEagerLoad&&h.startTracking()},__disabled:!1,disable:function(){i.log("FlashAPI.state: disable"),h.__disabled=!0,p(h.getEl(),{top:1,left:1,width:5,height:5})},ready:function(){i.log("FlashAPI.state: ready"),h.ready=i.F,h.isReady=!0,h.readyState=5,h.patch(),h.readyState=6,h.patchCamera&&h.patchCamera(),h.startTracking()},startTracking:function(){h.isTracking||(h.isTracking=!0,i.event.on(a,"mouseover",h.mouseover),i.event.on(a,"click",(function(e){h.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})))},getEl:function(){return a.getElementById("_"+u)},getWrapper:function(e){do{if(/js-fileapi-wrapper/.test(e.className))return e}while((e=e.parentNode)&&e!==a.body)},getHoverTargetElement:function(e){var t,n=e,r=0;do{r++,t=(n=n.parentNode).hasAttribute("data-fileapi-hover-class")}while(null!==n&&r<4&&!t);if(t)return n},isFlashTarget:function(e){return/input/i.test(e.nodeName)&&"file"===e.type&&(!i.support.html5||!1===i.html5||"function"==typeof i.html5&&!0!==i.html5(e))},mouseover:function(t){if(h.__disabled)return!1;var n=i.event.fix(t).target;if(n.className&&/fileapi-uploader/.test(n.className))do{n=n.nextSibling}while(null!==n&&1!=n.nodeType);if(null!==n)if(h.isFlashTarget(n)){var o=n.getAttribute(u),s=h.getWrapper(n);if(i.multiFlash){if(r("multiFlash",i.multiFlash),"i"==o||"r"==o)return!1;if("p"!=o){n.setAttribute(u,"i");var l=a.createElement("div");if(!s)return void i.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");p(l,{top:0,left:0,width:n.offsetWidth+100,height:n.offsetHeight+100,position:"absolute",overflow:"hidden",zIndex:"1000000"}),s.appendChild(l),h.publish(l,i.uid()),n.setAttribute(u,"p")}return!0}if(s){var f=h.getEl(),c=function(t){var n=t.getBoundingClientRect(),r=a.body,i=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||i.scrollTop)-(i.clientTop||r.clientTop||0),left:n.left+(e.pageXOffset||i.scrollLeft)-(i.clientLeft||r.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}(s);h.curInp=n,null!=f&&p(f,c);var d=h.getHoverTargetElement(s);if(d){var g=d.getAttribute("data-fileapi-hover-class");new RegExp(g).test(d.className)||(d.className+=" "+g)}/js-fileapi-hover/.test(s.className)||(s.className+=" js-fileapi-hover")}}else/object|embed/i.test(n.nodeName)||p(h.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{h.getInput(e.flashId).setAttribute(u,"r")}catch(e){}return h.ready(),setTimeout((function(){h.mouseenter(e)}),50),!0}"ping"===t?i.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?i.log("(flash -> js).log:",e.target):t in h&&setTimeout((function(){i.log("FlashAPI.event."+e.type+":",e),h[t](e)}),1)},mouseenter:function(e){var t=h.getInput(e.flashId);if(t){h.cmd(e,"multiple",null!=t.getAttribute("multiple"));var n=[],r={};l((t.getAttribute("accept")||"").split(/,\s*/),(function(e){i.accept[e]&&l(i.accept[e].split(" "),(function(e){r[e]=1}))})),l(r,(function(e,t){n.push(t)})),h.cmd(e,"accept",n.length?n.join(",")+","+n.join(",").toUpperCase():"*");var a=h.getWrapper(t);if(a){var o=h.getHoverTargetElement(a);if(o){var s=o.getAttribute("data-fileapi-hover-class");new RegExp(s).test(o.className)||(o.className+=" "+s)}/js-fileapi-hover/.test(a.className)||(a.className+=" js-fileapi-hover")}}},mouseleave:function(e){if(!h.__disabled){var t=h.getInput(e.flashId);if(t){var n=h.getWrapper(t);if(n){var r=h.getHoverTargetElement(n);if(r){var i=r.getAttribute("data-fileapi-hover-class");r.className=r.className.replace(new RegExp("\\s"+i),"")}n.className&&(n.className=n.className.replace(/\sjs-fileapi-hover/,""))}}}},get:function(t){return a[t]||e[t]||a.embeds[t]},getInput:function(e){if(!i.multiFlash)return h.curInp;try{var t=h.getWrapper(h.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(t){i.log('[err] Can not find "input" by flashId:',e,t)}},select:function(e){if(!h.__disabled){var n,r=h.getInput(e.flashId),o=i.uid(r),s=e.target.files;l(s,(function(e){i.checkFileObj(e)})),c[o]=s,a.createEvent?((n=a.createEvent("Event")).files=s,n.initEvent("change",!0,!0),r.dispatchEvent(n)):t?t(r).trigger({type:"change",files:s}):((n=a.createEventObject()).files=s,r.fireEvent("onchange",n))}},__browsing:!1,cancel:function(e){h.__browsing&&h.disable()},browse:function(t){h.__browsing=!0,e.setTimeout((function(){h.__browsing=!1}),10)},cmd:function(e,t,n,r){try{return i.log("(js -> flash)."+t+":",n),h.get(e.flashId||e).cmd(t,n)}catch(a){i.log("(js -> flash).onError:",a),r||setTimeout((function(){h.cmd(e,t,n,!0)}),50)}},patch:function(){i.flashEngine=!0,m(i,{getFiles:function(e,t,n){if(n)return i.filterFiles(i.getFiles(e),t,n),null;var r=i.isArray(e)?e:c[i.uid(e.target||e.srcElement||e)];return r?(t&&(t=i.getFilesFilter(t),r=i.filter(r,(function(e){return t.test(e.name)}))),r):this.parent.apply(this,arguments)},getInfo:function(e,t){if(v(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var n=e.__info=i.defer();h.cmd(e,"getFileInfo",{id:e.id,callback:y((function t(r,i){b(t),n.resolve(r,e.info=i)}))})}e.__info.then(t)}}}),i.support.transform=!0,i.Image&&m(i.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(i.log("FlashAPI.Image._load:",e),v(e))this.parent.apply(this,arguments);else{var n=this;i.getInfo(e,(function(r){t.call(n,r,e)}))}},_apply:function(e,t){if(i.log("FlashAPI.Image._apply:",e),v(e))this.parent.apply(this,arguments);else{var n=this.getMatrix(e.info),r=t;h.cmd(e,"imageTransform",{id:e.id,matrix:n,callback:y((function a(o,s){i.log("FlashAPI.Image._apply.callback:",o),b(a),o?r(o):i.support.html5||i.support.dataURI&&!(s.length>3e4)?(n.filter&&(r=function(e,r){e?t(e):i.Image.applyFilter(r,n.filter,(function(){t(e,this.canvas)}))}),i.newImage("data:"+e.type+";base64,"+s,r)):I({width:n.deg%180?n.dh:n.dw,height:n.deg%180?n.dw:n.dh,scale:n.scaleMode},s,r)}))})}},toData:function(e){if(i.log("FlashAPI.Image.toData"),v(this.file))this.parent.apply(this,arguments);else{var t=this.file,n=t.info,r=this.getMatrix(n);"auto"==r.deg&&(r.deg=i.Image.exifOrientation[n&&n.exif&&n.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:r})}}}),i.Image&&m(i.Image,{fromDataURL:function(e,t,n){!i.support.dataURI||e.length>3e4?I(i.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),(function(e,t){n(t)})):this.parent(e,t,n)}}),m(i.Form.prototype,{toData:function(e){for(var t=this.items,n=t.length;n--;)if(t[n].file&&v(t[n].blob))return this.parent.apply(this,arguments);i.log("FlashAPI.Form.toData"),e(t)}}),m(i.XHR.prototype,{_send:function(e,t){if(t.nodeName||(t.append||i.isFile(t.file))&&i.support.html5||i.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var n,r,a={},o={},s=this;if(l(t,(function(e){e.file?(o[e.name]=e=E(e.blob),r=e.id,n=e.flashId):a[e.name]=e.blob})),r||(n=u),!n)return i.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);i.log("FlashAPI.XHR._send: "+n+" -> "+r),s.xhr={headers:{},abort:function(){h.cmd(n,"abort",{id:r})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var f=i.queue((function(){h.cmd(n,"upload",{url:w(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:a,files:r?o:null,headers:e.headers||{},callback:y((function t(n){var r=n.type,a=n.result;i.log("FlashAPI.upload."+r),"progress"==r?(n.loaded=Math.min(n.loaded,n.total),n.lengthComputable=!0,e.progress(n)):"complete"==r?(b(t),"string"==typeof a&&(s.responseText=a.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),s.end(n.status||200)):"abort"!=r&&"error"!=r||(s.end(n.status||0,n.message),b(t))}))})}));l(o,(function(e){f.inc(),i.getInfo(e,f.next)})),f.check()}})}};i.Flash=h,i.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",(function(e,t){i.support.dataURI=!(1!=t.width||1!=t.height),h.init()}))}function g(e){return n("_makeFlashHTML"),('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,(function(t,n){return e[n]}))}function p(e,t){var n,r;if(e&&e.style)for(n in t){"number"==typeof(r=t[n])&&(r+="px");try{e.style[n]=r}catch(e){}}}function m(e,t){l(t,(function(t,n){var r=e[n];e[n]=function(){return this.parent=r,t.apply(this,arguments)}}))}function v(e){return e&&!e.flashId}function y(e){var t=e.wid=i.uid();return h._fn[t]=e,"FileAPI.Flash._fn."+t}function b(e){try{h._fn[e.wid]=null,delete h._fn[e.wid]}catch(e){}}function w(e,t){if(!d.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=o.pathname;e=((n=n.substr(0,n.lastIndexOf("/")))+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+o.host+e),d.test(e)||(e=o.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function I(e,t,r){n("_makeFlashImage");var o,s=i.uid(),l=a.createElement("div"),u=10;for(o in e)l.setAttribute(o,e[o]),l[o]=e[o];p(l,e),e.width="100%",e.height="100%",l.innerHTML=g(i.extend({id:s,src:w(i.flashImageUrl,"r="+i.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+y((function e(){return b(e),--u>0&&function(){try{h.get(s).setImage(t)}catch(e){i.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',e)}}(),!0}))},e)),r(!1,l),l=null}function E(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}}:function(){},i.flashEnabled&&(!0!==i.html5||!i.support.html5||i.cors&&!i.support.cors||i.media&&!i.support.media)&&i.flashInit()}(window,window.jQuery,FileAPI),function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[o]={exports:{}};t[o][0].call(f.exports,(function(e){var n=t[o][1][e];return i(n||e)}),f,f.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(require,e,t){function n(e){return this instanceof n?(this.length=0,this.parent=void 0,"number"==typeof e?r(this,e):"string"==typeof e?i(this,e,arguments.length>1?arguments[1]:"utf8"):a(this,e)):arguments.length>1?new n(e,arguments[1]):new n(e)}function r(e,t){if(e=o(e,0>t?0:0|s(t)),!n.TYPED_ARRAY_SUPPORT)for(var r=0;t>r;r++)e[r]=0;return e}function i(e,t,n){return("string"!=typeof n||""===n)&&(n="utf8"),(e=o(e,0|l(t,n))).write(t,n),e}function a(e,t){if(n.isBuffer(t))return function(e,t){var n=0|s(t.length);return e=o(e,n),t.copy(e,0,0,n),e}(e,t);if(R(t))return function(e,t){var n=0|s(t.length);e=o(e,n);for(var r=0;n>r;r+=1)e[r]=255&t[r];return e}(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer?function(e,t){var n=0|s(t.length);e=o(e,n);for(var r=0;n>r;r+=1)e[r]=255&t[r];return e}(e,t):t.length?function(e,t){var n=0|s(t.length);e=o(e,n);for(var r=0;n>r;r+=1)e[r]=255&t[r];return e}(e,t):function(e,t){var n,r=0;"Buffer"===t.type&&R(t.data)&&(n=t.data,r=0|s(n.length)),e=o(e,r);for(var i=0;r>i;i+=1)e[i]=255&n[i];return e}(e,t)}function o(e,t){return n.TYPED_ARRAY_SUPPORT?e=n._augment(new Uint8Array(t)):(e.length=t,e._isBuffer=!0),0!==t&&t<=n.poolSize>>>1&&(e.parent=U),e}function s(e){if(e>=B)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B.toString(16)+" bytes");return 0|e}function l(e,t){if("string"!=typeof e&&(e=String(e)),0===e.length)return 0;switch(t||"utf8"){case"ascii":case"binary":case"raw":return e.length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e.length;case"hex":return e.length>>>1;case"utf8":case"utf-8":return C(e).length;case"base64":return x(e).length;default:return e.length}}function u(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new Error("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;r>o;o++){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))throw new Error("Invalid hex string");e[n+o]=s}return o}function f(e,t,n,r){return L(C(t,e.length-n),e,n,r)}function c(e,t,n,r){return L(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function d(e,t,n,r){return c(e,t,n,r)}function h(e,t,n,r){return L(x(t),e,n,r)}function g(e,t,n,r){return L(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);o++)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function p(e,t,n){return F.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function m(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var a=t;n>a;a++)e[a]<=127?(r+=D(i)+String.fromCharCode(e[a]),i=""):i+="%"+e[a].toString(16);return r+D(i)}function v(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;n>i;i++)r+=String.fromCharCode(127&e[i]);return r}function y(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;n>i;i++)r+=String.fromCharCode(e[i]);return r}function b(e,t,n){var r,i=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>i)&&(n=i);for(var a="",o=t;n>o;o++)a+=16>(r=e[o])?"0"+r.toString(16):r.toString(16);return a}function w(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function I(e,t,n){if(e%1!=0||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function E(e,t,r,i,a,o){if(!n.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>a||o>t)throw new RangeError("value is out of bounds");if(r+i>e.length)throw new RangeError("index out of range")}function A(e,t,n,r){0>t&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);a>i;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function P(e,t,n,r){0>t&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);a>i;i++)e[n+i]=t>>>8*(r?i:3-i)&255}function S(e,t,n,r,i,a){if(t>i||a>t)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range");if(0>n)throw new RangeError("index out of range")}function O(e,t,n,r,i){return i||S(e,t,n,4,34028234663852886e22,-34028234663852886e22),_.write(e,t,n,r,23,4),n+4}function T(e,t,n,r,i){return i||S(e,t,n,8,17976931348623157e292,-17976931348623157e292),_.write(e,t,n,r,52,8),n+8}function C(e,t){t=t||1/0;for(var n,r=e.length,i=null,a=[],o=0;r>o;o++){if((n=e.charCodeAt(o))>55295&&57344>n){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(56320>n){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&((t-=3)>-1&&a.push(239,191,189),i=null);if(128>n){if((t-=1)<0)break;a.push(n)}else if(2048>n){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(65536>n){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(2097152>n))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function x(e){return F.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,n,r){for(var i=0;r>i&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function D(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}var F=require("base64-js"),_=require("ieee754"),R=require("is-array");t.Buffer=n,t.SlowBuffer=function e(t,r){if(!(this instanceof e))return new e(t,r);var i=new n(t,r);return delete i.parent,i},t.INSPECT_MAX_BYTES=50,n.poolSize=8192;var B=1073741823,U={};n.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}(),n.isBuffer=function(e){return!(null==e||!e._isBuffer)},n.compare=function(e,t){if(!n.isBuffer(e)||!n.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,a=0,o=Math.min(r,i);o>a&&e[a]===t[a];)++a;return a!==o&&(r=e[a],i=t[a]),i>r?-1:r>i?1:0},n.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(e,t){if(!R(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new n(0);if(1===e.length)return e[0];var r;if(void 0===t)for(t=0,r=0;r<e.length;r++)t+=e[r].length;var i=new n(t),a=0;for(r=0;r<e.length;r++){var o=e[r];o.copy(i,a),a+=o.length}return i},n.byteLength=l,n.prototype.length=void 0,n.prototype.parent=void 0,n.prototype.toString=function(e,t,n){var r=!1;if(e||(e="utf8"),0>(t|=0)&&(t=0),(n=void 0===n||n===1/0?this.length:0|n)>this.length&&(n=this.length),t>=n)return"";for(;;)switch(e){case"hex":return b(this,t,n);case"utf8":case"utf-8":return m(this,t,n);case"ascii":return v(this,t,n);case"binary":return y(this,t,n);case"base64":return p(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}},n.prototype.equals=function(e){if(!n.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===n.compare(this,e)},n.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},n.prototype.compare=function(e){if(!n.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:n.compare(this,e)},n.prototype.indexOf=function(e,t){function r(e,t,n){for(var r=-1,i=0;n+i<e.length;i++)if(e[n+i]===t[-1===r?0:i-r]){if(-1===r&&(r=i),i-r+1===t.length)return n+r}else r=-1;return-1}if(t>2147483647?t=2147483647:-2147483648>t&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(0>t&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(n.isBuffer(e))return r(this,e,t);if("number"==typeof e)return n.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):r(this,[e],t);throw new TypeError("val must be string, number or Buffer")},n.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},n.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},n.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else{var i=r;r=t,t=0|n,n=i}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(0>n||0>t)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return u(this,e,t,n);case"utf8":case"utf-8":return f(this,e,t,n);case"ascii":return c(this,e,t,n);case"binary":return d(this,e,t,n);case"base64":return h(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},n.prototype.slice=function(e,t){var r,i=this.length;if(0>(e=~~e)?0>(e+=i)&&(e=0):e>i&&(e=i),0>(t=void 0===t?i:~~t)?0>(t+=i)&&(t=0):t>i&&(t=i),e>t&&(t=e),n.TYPED_ARRAY_SUPPORT)r=n._augment(this.subarray(e,t));else{var a=t-e;r=new n(a,void 0);for(var o=0;a>o;o++)r[o]=this[o+e]}return r.length&&(r.parent=this.parent||this),r},n.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},n.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},n.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},n.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},n.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},n.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},n.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},n.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},n.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},n.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},n.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},n.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},n.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},n.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},n.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),_.read(this,e,!0,23,4)},n.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),_.read(this,e,!1,23,4)},n.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),_.read(this,e,!0,52,8)},n.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),_.read(this,e,!1,52,8)},n.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||E(this,e,t,n,Math.pow(2,8*n),0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},n.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||E(this,e,t,n,Math.pow(2,8*n),0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},n.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,1,255,0),n.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e,t+1},n.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},n.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):A(this,e,t,!1),t+2},n.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e):P(this,e,t,!0),t+4},n.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):P(this,e,t,!1),t+4},n.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);E(this,e,t,n,i-1,-i)}var a=0,o=1,s=0>e?1:0;for(this[t]=255&e;++a<n&&(o*=256);)this[t+a]=(e/o>>0)-s&255;return t+n},n.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);E(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0>e?1:0;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=(e/o>>0)-s&255;return t+n},n.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,1,127,-128),n.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=e,t+1},n.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},n.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):A(this,e,t,!1),t+2},n.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,4,2147483647,-2147483648),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},n.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||E(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):P(this,e,t,!1),t+4},n.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},n.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},n.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},n.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},n.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&r>i&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>i)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var a=i-r;if(1e3>a||!n.TYPED_ARRAY_SUPPORT)for(var o=0;a>o;o++)e[o+t]=this[o+r];else e._set(this.subarray(r,r+a),t);return a},n.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),t>n)throw new RangeError("end < start");if(n!==t&&0!==this.length){if(0>t||t>=this.length)throw new RangeError("start out of bounds");if(0>n||n>this.length)throw new RangeError("end out of bounds");var r;if("number"==typeof e)for(r=t;n>r;r++)this[r]=e;else{var i=C(e.toString()),a=i.length;for(r=t;n>r;r++)this[r]=i[r%a]}return this}},n.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(n.TYPED_ARRAY_SUPPORT)return new n(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;r>t;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var k=n.prototype;n._augment=function(e){return e.constructor=n,e._isBuffer=!0,e._set=e.set,e.get=k.get,e.set=k.set,e.write=k.write,e.toString=k.toString,e.toLocaleString=k.toString,e.toJSON=k.toJSON,e.equals=k.equals,e.compare=k.compare,e.indexOf=k.indexOf,e.copy=k.copy,e.slice=k.slice,e.readUIntLE=k.readUIntLE,e.readUIntBE=k.readUIntBE,e.readUInt8=k.readUInt8,e.readUInt16LE=k.readUInt16LE,e.readUInt16BE=k.readUInt16BE,e.readUInt32LE=k.readUInt32LE,e.readUInt32BE=k.readUInt32BE,e.readIntLE=k.readIntLE,e.readIntBE=k.readIntBE,e.readInt8=k.readInt8,e.readInt16LE=k.readInt16LE,e.readInt16BE=k.readInt16BE,e.readInt32LE=k.readInt32LE,e.readInt32BE=k.readInt32BE,e.readFloatLE=k.readFloatLE,e.readFloatBE=k.readFloatBE,e.readDoubleLE=k.readDoubleLE,e.readDoubleBE=k.readDoubleBE,e.writeUInt8=k.writeUInt8,e.writeUIntLE=k.writeUIntLE,e.writeUIntBE=k.writeUIntBE,e.writeUInt16LE=k.writeUInt16LE,e.writeUInt16BE=k.writeUInt16BE,e.writeUInt32LE=k.writeUInt32LE,e.writeUInt32BE=k.writeUInt32BE,e.writeIntLE=k.writeIntLE,e.writeIntBE=k.writeIntBE,e.writeInt8=k.writeInt8,e.writeInt16LE=k.writeInt16LE,e.writeInt16BE=k.writeInt16BE,e.writeInt32LE=k.writeInt32LE,e.writeInt32BE=k.writeInt32BE,e.writeFloatLE=k.writeFloatLE,e.writeFloatBE=k.writeFloatBE,e.writeDoubleLE=k.writeDoubleLE,e.writeDoubleBE=k.writeDoubleBE,e.fill=k.fill,e.inspect=k.inspect,e.toArrayBuffer=k.toArrayBuffer,e};var M=/[^+\/0-9A-z\-]/g},{"base64-js":2,ieee754:3,"is-array":4}],2:[function(require,e,t){!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===r||t===l?62:t===i||t===u?63:a>t?-1:a+10>t?t-a+26+26:s+26>t?t-s:o+26>t?t-o+26:void 0}var n="undefined"!=typeof Uint8Array?Uint8Array:Array,r="+".charCodeAt(0),i="/".charCodeAt(0),a="0".charCodeAt(0),o="a".charCodeAt(0),s="A".charCodeAt(0),l="-".charCodeAt(0),u="_".charCodeAt(0);e.toByteArray=function(e){function r(e){u[c++]=e}var i,a,o,s,l,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var f=e.length;l="="===e.charAt(f-2)?2:"="===e.charAt(f-1)?1:0,u=new n(3*e.length/4-l),o=l>0?e.length-4:e.length;var c=0;for(i=0,a=0;o>i;i+=4,a+=3)r((16711680&(s=t(e.charAt(i))<<18|t(e.charAt(i+1))<<12|t(e.charAt(i+2))<<6|t(e.charAt(i+3))))>>16),r((65280&s)>>8),r(255&s);return 2===l?r(255&(s=t(e.charAt(i))<<2|t(e.charAt(i+1))>>4)):1===l&&(r((s=t(e.charAt(i))<<10|t(e.charAt(i+1))<<4|t(e.charAt(i+2))>>2)>>8&255),r(255&s)),u},e.fromByteArray=function(e){function t(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}var n,r,i,a,o=e.length%3,s="";for(n=0,i=e.length-o;i>n;n+=3)r=(e[n]<<16)+(e[n+1]<<8)+e[n+2],s+=t((a=r)>>18&63)+t(a>>12&63)+t(a>>6&63)+t(63&a);switch(o){case 1:s+=t((r=e[e.length-1])>>2),s+=t(r<<4&63),s+="==";break;case 2:s+=t((r=(e[e.length-2]<<8)+e[e.length-1])>>10),s+=t(r>>4&63),s+=t(r<<2&63),s+="="}return s}}(void 0===t?this.base64js={}:t)},{}],3:[function(require,e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,f=-7,c=n?i-1:0,d=n?-1:1,h=e[t+c];for(c+=d,a=h&(1<<-f)-1,h>>=-f,f+=s;f>0;a=256*a+e[t+c],c+=d,f-=8);for(o=a&(1<<-f)-1,a>>=-f,f+=r;f>0;o=256*o+e[t+c],c+=d,f-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=u}return(h?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,f=(1<<u)-1,c=f>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,g=r?1:-1,p=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(o++,l/=2),o+c>=f?(s=0,o=f):o+c>=1?(s=(t*l-1)*Math.pow(2,i),o+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=255&s,h+=g,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+h]=255&o,h+=g,o/=256,u-=8);e[n+h-g]|=128*p}},{}],4:[function(require,e,t){var n=Array.isArray,r=Object.prototype.toString;e.exports=n||function(e){return!!e&&"[object Array]"==r.call(e)}},{}],5:[function(require,e,t){var n=require("./index");(function(){return this}()).ExifParser=n},{"./index":6}],6:[function(require,e,t){var n=require("./lib/parser"),r=require("./lib/exif");e.exports={create:function(e,t){if(e instanceof(t=t||function(){return this}()).ArrayBuffer){var r=require("./lib/dom-bufferstream");return new n(new r(e,0,e.byteLength,!0,t))}var i=require("./lib/bufferstream");return new n(new i(e,0,e.length,!0))},createOK:function(e,t){var r=require("../buffer/index"),i=new(require("./lib/bufferstream"))(r.Buffer(e,"binary"),0,t,!0);return new n(i)},IFD0:r.IFD0,IFD1:r.IFD1,GPSIFD:r.GPSIFD,SubIFD:r.SubIFD,InteropIFD:r.InteropIFD}},{"../buffer/index":1,"./lib/bufferstream":7,"./lib/dom-bufferstream":9,"./lib/exif":11,"./lib/parser":13}],7:[function(require,e,t){function n(e,t,n,r){this.buffer=e,this.offset=t||0,n="number"==typeof n?n:e.length,this.endPosition=this.offset+n,this.setBigEndian(r)}n.prototype={setBigEndian:function(e){this.bigEndian=!!e},nextUInt8:function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.buffer.readInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,e},nextUInt32:function(){var e=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,e},nextInt16:function(){var e=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,e},nextInt32:function(){var e=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,e},nextFloat:function(){var e=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,e},nextDouble:function(){var e=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,e},nextBuffer:function(e){var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.endPosition-this.offset},nextString:function(e){var t=this.buffer.toString("ascii",this.offset,this.offset+e);return this.offset+=e,t},mark:function(){var e=this;return{openWithOffset:function(t){return t=(t||0)+this.offset,new n(e.buffer,t,e.endPosition-t,e.bigEndian)},offset:this.offset}},offsetFrom:function(e){return this.offset-e.offset},skip:function(e){this.offset+=e},branch:function(e,t){return t="number"==typeof t?t:this.endPosition-(this.offset+e),new n(this.buffer,this.offset+e,t,this.bigEndian)}},e.exports=n},{}],8:[function(require,e,t){function n(e){return parseInt(e,10)}function r(e,t){e=e.map(n),t=t.map(n);var r=new Date;return r.setUTCFullYear(e[0]),r.setUTCMonth(e[1]-1),r.setUTCDate(e[2]),r.setUTCHours(t[0]),r.setUTCMinutes(t[1]),r.setUTCSeconds(t[2]),r.setUTCMilliseconds(0),r.getTime()/1e3}function i(e){var t=e.substr(0,10).split("-"),i=e.substr(11,8).split(":"),a=e.substr(19,6).split(":").map(n),l=a[0]*o+a[1]*s,u=r(t,i);return"number"!=typeof(u-=l)||isNaN(u)?void 0:u}function a(e){var t=e.split(" "),n=r(t[0].split(":"),t[1].split(":"));return"number"!=typeof n||isNaN(n)?void 0:n}var o=3600,s=60;e.exports={parseDateWithSpecFormat:a,parseDateWithTimezoneFormat:i,parseExifDate:function(e){var t=19===e.length&&":"===e.charAt(4);return 25===e.length&&"T"===e.charAt(10)?i(e):t?a(e):void 0}}},{}],9:[function(require,e,t){function n(e,t,n,r,i,a){this.global=i,t=t||0,n=n||e.byteLength-t,this.arrayBuffer=e.slice(t,t+n),this.view=new i.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(r),this.offset=0,this.parentOffset=(a||0)+t}n.prototype={setBigEndian:function(e){this.littleEndian=!e},nextUInt8:function(){var e=this.view.getUint8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.view.getInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},nextUInt32:function(){var e=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},nextInt16:function(){var e=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},nextInt32:function(){var e=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},nextFloat:function(){var e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},nextDouble:function(){var e=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},nextBuffer:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return t=String.fromCharCode.apply(null,new this.global.Uint8Array(t)),this.offset+=e,t},mark:function(){var e=this;return{openWithOffset:function(t){return t=(t||0)+this.offset,new n(e.arrayBuffer,t,e.arrayBuffer.byteLength-t,!e.littleEndian,e.global,e.parentOffset)},offset:this.offset,getParentOffset:function(){return e.parentOffset}}},offsetFrom:function(e){return this.parentOffset+this.offset-(e.offset+e.getParentOffset())},skip:function(e){this.offset+=e},branch:function(e,t){return t="number"==typeof t?t:this.arrayBuffer.byteLength-(this.offset+e),new n(this.arrayBuffer,this.offset+e,t,!this.littleEndian,this.global,this.parentOffset)}},e.exports=n},{}],10:[function(require,e,t){e.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}},{}],11:[function(require,e,t){function n(e,t){switch(e){case 1:return t.nextUInt8();case 3:return t.nextUInt16();case 4:return t.nextUInt32();case 5:return[t.nextUInt32(),t.nextUInt32()];case 6:return t.nextInt8();case 8:return t.nextUInt16();case 9:return t.nextUInt32();case 10:return[t.nextInt32(),t.nextInt32()];case 11:return t.nextFloat();case 12:return t.nextDouble();default:throw new Error("Invalid format while decoding: "+e)}}function r(e,t){var r,i,a=t.nextUInt16(),o=t.nextUInt16(),s=function(e){switch(e){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:throw new Error("Invalid format: "+e)}}(o),l=t.nextUInt32(),u=s*l;if(u>4&&(t=e.openWithOffset(t.nextUInt32())),2===o){var f=(r=t.nextString(l)).indexOf("\0");-1!==f&&(r=r.substr(0,f))}else if(7===o)r=t.nextBuffer(l);else for(r=[],i=0;l>i;++i)r.push(n(o,t));return 4>u&&t.skip(4-u),[a,r,o]}function i(e,t,n){var i,a,o=t.nextUInt16();for(a=0;o>a;++a)n((i=r(e,t))[0],i[1],i[2])}e.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(e,t){var n;try{n=function(e){if("Exif\0\0"!==e.nextString(6))throw new Error("Invalid EXIF header");var t=e.mark(),n=e.nextUInt16();if(18761===n)e.setBigEndian(!1);else{if(19789!==n)throw new Error("Invalid TIFF header");e.setBigEndian(!0)}if(42!==e.nextUInt16())throw new Error("Invalid TIFF data");return t}(e)}catch(e){return!1}var r,a,o,s=n.openWithOffset(e.nextUInt32()),l=this.IFD0;i(n,s,(function(e,n,i){switch(e){case 34853:a=n[0];break;case 34665:r=n[0];break;default:t(l,e,n,i)}}));var u=s.nextUInt32();if(0!==u){var f=n.openWithOffset(u);i(n,f,t.bind(null,this.IFD1))}if(a){var c=n.openWithOffset(a);i(n,c,t.bind(null,this.GPSIFD))}if(r){var d=n.openWithOffset(r),h=this.InteropIFD;i(n,d,(function(e,n,r){40965===e?o=n[0]:t(h,e,n,r)}))}if(o){var g=n.openWithOffset(o);i(n,g,t.bind(null,this.InteropIFD))}return!0}}},{}],12:[function(require,e,t){e.exports={parseSections:function(e,t){var n,r;for(e.setBigEndian(!0);e.remainingLength()>0&&218!==r;){if(255!==e.nextUInt8())throw new Error("Invalid JPEG section offset");n=(r=e.nextUInt8())>=208&&217>=r||218===r?0:e.nextUInt16()-2,t(r,e.branch(0,n)),e.skip(n)}},getSizeFromSOFSection:function(e){return e.skip(1),{height:e.nextUInt16(),width:e.nextUInt16()}},getSectionName:function(e){var t,n;switch(e){case 216:t="SOI";break;case 196:t="DHT";break;case 219:t="DQT";break;case 221:t="DRI";break;case 218:t="SOS";break;case 254:t="COM";break;case 217:t="EOI";break;default:e>=224&&239>=e?(t="APP",n=e-224):e>=192&&207>=e&&196!==e&&200!==e&&204!==e?(t="SOF",n=e-192):e>=208&&215>=e&&(t="RST",n=e-208)}var r={name:t};return"number"==typeof n&&(r.index=n),r}}},{}],13:[function(require,e,t){function n(e,t,n,r,i,a,o){this.startMarker=e,this.tags=t,this.imageSize=n,this.thumbnailOffset=r,this.thumbnailLength=i,this.thumbnailType=a,this.app1Offset=o}function r(e){this.stream=e,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}var i=require("./jpeg"),a=require("./exif"),o=require("./simplify");n.prototype={hasThumbnail:function(e){return!(!this.thumbnailOffset||!this.thumbnailLength||"string"==typeof e&&("image/jpeg"===e.toLowerCase().trim()?6!==this.thumbnailType:"image/tiff"!==e.toLowerCase().trim()||1!==this.thumbnailType))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var e,t=this._getThumbnailStream();return i.parseSections(t,(function(t,n){"SOF"===i.getSectionName(t).name&&(e=i.getSizeFromSOFSection(n))})),e}},r.prototype={enableBinaryFields:function(e){return this.flags.readBinaryTags=!!e,this},enablePointers:function(e){return this.flags.hidePointers=!e,this},enableTagNames:function(e){return this.flags.resolveTagNames=!!e,this},enableImageSize:function(e){return this.flags.imageSize=!!e,this},enableReturnTags:function(e){return this.flags.returnTags=!!e,this},enableSimpleValues:function(e){return this.flags.simplifyValues=!!e,this},parse:function(){var e,t,r,s,l,u,f,c,d,h=this.stream.mark(),g=h.openWithOffset(0),p=this.flags;return p.resolveTagNames&&(f=require("./exif-tags")),p.resolveTagNames?(e={},c=function(t){return e[t.name]},d=function(t,n){e[t.name]=n}):(e=[],c=function(t){var n;for(n=0;n<e.length;++n)if(e[n].type===t.type&&e[n].section===t.section)return e.value},d=function(t,n){var r;for(r=0;r<e.length;++r)if(e[r].type===t.type&&e[r].section===t.section)return void(e.value=n)}),i.parseSections(g,(function(n,c){var d=c.offsetFrom(h);225===n?a.parseTags(c,(function(t,n,i,u){if(p.readBinaryTags||7!==u){if(513===n){if(r=i[0],p.hidePointers)return}else if(514===n){if(s=i[0],p.hidePointers)return}else if(259===n&&(l=i[0],p.hidePointers))return;if(p.returnTags)if(p.simplifyValues&&(i=o.simplifyValue(i,u)),p.resolveTagNames){var c=(t===a.GPSIFD?f.gps:f.exif)[n];c||(c=f.exif[n]),e[c]=i}else e.push({section:t,type:n,value:i})}}))&&(u=d):p.imageSize&&"SOF"===i.getSectionName(n).name&&(t=i.getSizeFromSOFSection(c))})),p.simplifyValues&&(o.castDegreeValues(c,d),o.castDateValues(c,d)),new n(h,e,t,r,s,l,u)}},e.exports=r},{"./exif":11,"./exif-tags":10,"./jpeg":12,"./simplify":14}],14:[function(require,e,t){var n=require("./exif"),r=require("./date"),i=[{section:n.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:n.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],a=[{section:n.SubIFD,type:36867,name:"DateTimeOriginal"},{section:n.SubIFD,type:36868,name:"CreateDate"}];e.exports={castDegreeValues:function(e,t){i.forEach((function(n){var r=e(n);if(r){var i=e({section:n.section,type:n.refType,name:n.refName})===n.posVal?1:-1,a=(r[0]+r[1]/60+r[2]/3600)*i;t(n,a)}}))},castDateValues:function(e,t){a.forEach((function(n){var i=e(n);if(i){var a=r.parseExifDate(i);void 0!==a&&t(n,a)}}))},simplifyValue:function(e,t){return Array.isArray(e)&&1===(e=e.map((function(e){return 10===t||5===t?e[0]/e[1]:e}))).length&&(e=e[0]),e}}},{"./date":8,"./exif":11}]},{},[5]),FileAPI.support.exif=!0,FileAPI.addInfoReader(/^image/,(function(e,t){if(!e.__exif){var n=e.__exif=FileAPI.defer(),r=e;if(r instanceof Blob&&r.size>131072)try{var i=Math.min(r.size,131072);r=(r.slice||r.mozSlice||r.webkitSlice).call(r,0,i)}catch(e){FileAPI.log("exception "+e)}FileAPI.readAsBinaryString(r,(function(e){if("load"==e.type){var t=window.ExifParser.createOK(e.result,r.size);t.enableTagNames(!1),t.enableBinaryFields(!1);var i,a,o={},s=function(e){switch(e){case window.ExifParser.IFD0:case window.ExifParser.IFD1:case window.ExifParser.SubIFD:case window.ExifParser.InteropIFD:return 0;case window.ExifParser.GPSIFD:return 1;default:return 2}};try{var l;i=t.parse();for(var u=0;u<i.tags.length;++u)l=i.tags[u],o[65536*s(l.section)+l.type]=l.value}catch(e){a=""}var f={toString:function(){if(void 0===a){var e;a="";for(var t=0;t<i.tags.length;++t)e=i.tags[t],a+=65536*s(e.section)+e.type+":"+e.value+"\n"}return a},Orientation:o[274],V2:!0};n.resolve(!1,{exif:f})}else"error"==e.type&&n.resolve("read_as_binary_string_exif")}))}e.__exif.then(t)})),FileAPI})),define("OK/AttachType",["require","exports"],(function(require,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AttachType=void 0,function(e){e.PHOTOODKL="PHOTOODKL",e.PHOTOUPLOADED="PHOTOUPLOADED"}(e.AttachType||(e.AttachType={}))})),define("OK/EventFactoryForEventBus",["require","exports"],(function(require,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.eventFactory=void 0;var t=function(){this.list=[]};t.prototype._callHandler=function(e,t,n){return e.call(n,t),this},t.prototype.trigger=function(e){for(var t=this,n=t.list.slice(),r=arguments[1],i=[],a=0,o=n.length;a<o;a++){var s=n[a];s&&(s.once&&i.push(s),t._callHandler(s.handler,e||r,s.context))}return i.forEach((function(e){var n=t.list.indexOf(e);-1!==n&&t.list.splice(n,1)})),t},t.prototype.attach=function(e,n){return this.list.push(t.wrapMethod(e,n)),this},t.prototype.attachOnce=function(e,n){var r=t.wrapMethod(e,n);return r.once=!0,this.list.push(r),this},t.prototype.detach=function(e,t){for(var n=this.list,r=n.length;r-- >0;){var i=n[r];i.handler===e&&i.context===t&&n.splice(r,1)}return this},t.wrapMethod=function(e,t){return{context:t,handler:e,once:!1}},e.eventFactory={create:function(){return new t}}})),define("OK/EventBus",["require","exports","OK/EventFactoryForEventBus"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventBus=void 0;var n=function e(t){var n=this;this.listeners=new Map,this.emit=function(t,r){return e.emit({prefix:n.prefix,name:n.name,data:t,target:r})},this.on=function(t,r){var i=n.makeListener(t,r);e.on(i)},this.off=function(t){var r=n.listeners.get(t);r&&(e.off(r),n.listeners.delete(t))},this.isMe=function(e){return n.name===e.name&&n.prefix===e.prefix},this.makeListener=function(e,t){if(n.listeners.has(e))throw new Error("EventBus["+n.prefix+", "+n.name+"]: повторное добавление обработчика");var r=n,i=function(n){var i=n.detail;if(!n.defaultPrevented&&r.isMe(i)&&(!t||!i.target||t!==i.target))return e(i.data)}.bind(n);return n.listeners.set(e,i),i},this.prefix=t.prefix,this.name=t.name};n.factory=function(e){return function(t){return n.create({prefix:e,name:t})}},e.EventBus=n,n.EVENT_NAME="okeventbus",n.eventHost=t.eventFactory.create(),n.registeredBuses=new Set,n.getRegisteredBuses=function(){return n.registeredBuses},n.getHost=function(){return n.eventHost},n.createEvent=function(e){return new CustomEvent(n.EVENT_NAME,{detail:e,bubbles:!1,cancelable:!0})},n.on=function(e){if(n.hasListener(e))throw new Error("EventBus: повторное добавление обработчика");n.eventHost.attach(e)},n.off=function(e){n.eventHost.detach(e)},n.emit=function(e){var t=n.createEvent(e);return n.eventHost.trigger(t),!t.defaultPrevented},n.findRegistered=function(e){var t=null;return n.registeredBuses.forEach((function(n){!t&&n.isMe(e)&&(t=n)})),t},n.create=function(e){return n.getInstance(e)},n.getInstance=function(e){var t=n.findRegistered(e);return t||(t=new n(e),n.getRegisteredBuses().add(t)),t},n.hasListener=function(e){return n.eventHost.list.some((function(t){return t.handler===e}))}})),define("OK/PhotoPickerEventBuses",["require","exports","OK/EventBus"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SHOW_PICKER=e.SHOW_CHANGE_AVATAR=e.CLOSE_PICKER=e.UPLOAD_DND_FILE=e.SELECT_PHOTO_FILE_OLD=e.SELECT_PHOTO_FILE=e.SELECT_CHAT_AVATAR=e.SELECT_PHOTO_IDS=e.PhotoPickerEventBusesPrefix=void 0,e.PhotoPickerEventBusesPrefix="actionsInPhotoPicker";var n=t.EventBus.factory(e.PhotoPickerEventBusesPrefix);e.SELECT_PHOTO_IDS=n("photoPickerPhotoIds"),e.SELECT_CHAT_AVATAR=n("photoPickerChatAvatar"),e.SELECT_PHOTO_FILE=n("photoPickerPhotoFiles"),e.SELECT_PHOTO_FILE_OLD=n("photoPickerPhotoFilesOld"),e.UPLOAD_DND_FILE=n("photoPickerUploadDnd"),e.CLOSE_PICKER=n("photoPickerClose"),e.SHOW_CHANGE_AVATAR=n("changeAvatarShow"),e.SHOW_PICKER=n("photoPickerShow")})),define("OK/PhotoUploaderEventBuses",["require","exports","OK/EventBus"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PHOTO_LIST_UPLOADED=e.PHOTO_LIST_UPLOAD_START=e.PHOTO_CREATED=e.PHOTO_UPLOAD_ERROR=e.PHOTO_UPLOADED_WITH_DELAYED_SAVE=e.PHOTO_UPLOADED=e.UPLOAD_PROGRESS=e.PHOTO_UPLOAD_START=e.PhotoUploaderEventBusesPrefix=void 0,e.PhotoUploaderEventBusesPrefix="photoUploaderEvents";var n=t.EventBus.factory(e.PhotoUploaderEventBusesPrefix);e.PHOTO_UPLOAD_START=n("photoUploadStart"),e.UPLOAD_PROGRESS=n("uploadProgress"),e.PHOTO_UPLOADED=n("photoUploaded"),e.PHOTO_UPLOADED_WITH_DELAYED_SAVE=n("photoUploadedWithDelayedSave"),e.PHOTO_UPLOAD_ERROR=n("photoUploadError"),e.PHOTO_CREATED=n("photoCreated"),e.PHOTO_LIST_UPLOAD_START=n("photoListUploadStart"),e.PHOTO_LIST_UPLOADED=n("photoListUploaded")})),define("OK/AttachPicker",["jquery","FileAPI","OK/AttachType","OK/PhotoPickerEventBuses","OK/PhotoUploaderEventBuses","OK/utils/utils"],(function(e,t,n,r,i,a){"use strict";var o,s={},l=0,u="localStorage"in window&&null!==window.localStorage,f={},c={},d="OK/messages2/app",h=e({});function g(e){return e&&0===e.indexOf("tt_")}function p(e,t){g(e)&&require.defined(d)&&require(d).attachesSelected({objectId:e,attaches:t})}function m(e){return"fileId"in e||(e.fileId=-a.positiveId()),E.serialize(e.fileId,n.AttachType.PHOTOUPLOADED)}function v(e){return E.serialize(e.id,n.AttachType.PHOTOODKL)}function y(e){var t=e.params.objectId;t&&E.has(t)&&E.add(t,e.files.map(v))}function b(e){var n=e.params.objectId;if(n&&E.has(n)){var r=t.getFiles(e.files);E.add(n,r.map(m)),require(["OK/photoUploadFacade"],(function(e){var t=E.get(n);e.video_cover.onFilesArraySelect(r,{allocateAt:t.allocateUrl,objectId:n,place:t.place})}))}}function w(e){var t=(e.uploadArgs||{}).objectId;if(t&&E.has(t)){var r=P(t);if(r.length){var i=e.photo;E.replace(t,r,[E.serialize(parseInt(i.photoId,16),n.AttachType.PHOTOUPLOADED,null,i.token)])}}}function I(e){var t=(e.uploadArgs||{}).objectId;if(t&&E.has(t)){var n=P(t);n.length&&E.remove(t,n[0].type+"_"+n[0].id)}}var E=function(){};function A(e,t,n){var r=c[e.id];return!!r&&(E.get(n).sendUploadedAttachesCb(r,t),delete c[e.id],!0)}function P(e){var t;if(E.get(e).supportsLs){var n="AttachPicker."+e;return(t=JSON.parse(localStorage.getItem(n)))||[]}return(t=f[e])||(f[e]=t=[]),t}function S(e,t){if(E.get(e).supportsLs){var n="AttachPicker."+e;0==t.length?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}else f[e]=t}function O(e){e.warningContainer.addClass("__active"),setTimeout((function(){e.warningContainer&&e.warningContainer.removeClass("__active")}),3e3)}function T(e,t,n){var r=n&&n.files,i=r?n.files:P(e.objectId),a=JSON.stringify(i);if(r){if(n.callback){var o=n.callback;n.callback=null,o(a),E.destroy(e.objectId)}}else a=function(e,t,n){var r=[];return e.forEach((function(e){if(t.separateUploadTypes.indexOf(e.type)>-1){var n=e.id;n<0&&!c[n]&&(c[n]=t.serializeAttachesCb(e)),r.push(e)}})),r.length>0&&(r.forEach((function(t){var n=e.indexOf(t);n>-1&&e.splice(n,1)})),n=JSON.stringify(e)),n}(i,e,a),e.button&&(i.length>=e.maxCount?e.button.removeClass("invisible"):e.button.addClass("invisible")),e.attachedInput&&e.attachedInput.length>0&&e.attachedInput.val(a),e.previewUrl&&require(["OK/AttachPreview"],(function(t){t.update(e,a).done((function(){e.trigger("update")}))}))}return E.serialize=function(e,t,n,r){var i={type:t.toString(),id:e};return r?i.token=r:((n||0==n)&&"PHOTOERROR"===i.type&&(i.error=n.toString()),"VIDEOERROR"===i.type&&(i.error=n?n.toString():"video_default")),i},E.addRecentGif=function(e,t){var n=t.attr("data-token");t[0].hasAttribute("data-close-smiles")&&OK.Layers.unregisterLast(),a.ajax({type:"POST",url:"/web-api/photo/upload/attach/fixToken",data:{tokenTemplate:n}}).done((function(t,n,r){if(t){var i=t.photoId,a=t.token,o=E.serialize(i,"RECENTGIF",void 0,a);E.add(e,[o])}}))},E.get=function(t,n){var a=s[t];return a||(s[t]=a=e.extend(e({}),{_counter:0,objectId:t,maxCount:8,single:false,supportsLs:u,warningContainer:e(),attachedInput:e(),place:null,sessions:{},activeSession:null,edited:!1,separateUploadTypes:[],serializeAttachesCb:function(){},sendUploadedAttachesCb:function(){}}),1===++l&&(r.SELECT_PHOTO_IDS.on(y,E),r.SELECT_PHOTO_FILE.on(b,E),r.UPLOAD_DND_FILE.on(b,E),i.PHOTO_UPLOADED_WITH_DELAYED_SAVE.on(w,E),i.PHOTO_UPLOAD_ERROR.on(I,E))),n&&a._counter++,a},E.has=function(e){return Boolean(s[e])},E.startSession=function(e){var t=E.get(e);if(t.activeSession)return t.activeSession;var n=OK.util.nextId(),r={sessionId:n,previewContainer:t.previewContainer,files:null,callback:null,data:null};return t.sessions[n]=r,t.activeSession=r,r},E.detachSession=function(e,t,n){var r=E.get(e,!0).activeSession;return r.callback=t,r.files=P(e),r.data=n,E.clear(e),r},E.findSession=function(e,t){var n=E.get(e,!0);if(n.sessions)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)&&n.sessions[r].data===t)return n.sessions[r];return null},E.updatePreviewContainer=function(t,n){var r=E.get(t,!0),i=e(n);for(var a in r.sessions)r.sessions.hasOwnProperty(a)&&(r.sessions[a].previewContainer=i)},E.getRemainingCount=function(e){return E.get(e).maxCount-P(e).length},E.getCount=function(e){return P(e).length||0},E.add=function(e,t,n){for(var r=E.get(e),i=P(e),a=0,o=0,s=0;s<t.length;++s){var l=t[s];if(!(i.indexOf(l)>=0))if(r.single)++o,i.length?i[0]=l:i.push(l);else{if(i.length>=r.maxCount){++a;continue}++o,i.push(l)}}return S(e,i),!n&&a>0&&O(r),o>0&&T(r,!1),0===a},E.isEdited=function(e){var t=E.get(e);if(t)return t.edited},E.edit=function(e){var t=E.get(e);t&&(t.edited=!0)},E.remove=function(t,n,r){if(r)return r.callback=null,delete E.get(t).sessions[r.sessionId],void h.triggerHandler("remove.session."+t,[r]);var i=P(t),a=n.split(":")[0].split("_"),o="null"===a[1];e.each(i,(function(e,n){n&&n.type==a[0]&&(o||n.id==a[1])&&(i.splice(e,1),S(t,i),T(E.get(t),!0),h.triggerHandler("remove."+t,[a[0],a[1]]))}))},E.removeMultiple=function(t,n,r){var i=P(t),a=i.length,o=[];n=n.replace(/&quot;/gi,'"'),(n=JSON.parse(n)).forEach((function(t){var n,a=t.split(":")[0].split("_"),s="null"===a[1];e.each(i,(function(e,t){t&&t.type==a[0]&&(s||t.id==a[1])&&(n=i.splice(e,1),r&&o.push(n[0]))}))})),i.length!=a&&(r&&E.saveUnsent(t,o),S(t,i),T(E.get(t),!0))},E.saveUnsent=function(e,t){o={objectId:e,ids:t}},E.restoreUnsent=function(){o&&(E.add(o.objectId,o.ids),o=null)},E.replace=function(t,n,r,i){for(var a=i&&i.files,o=a?i.files:P(t),s=0;s<n.length;s++){var l=n[s].id,u=n[s].type,f=r[s];e.each(o,(function(e,n){if(n.type===u&&n.id===(-0===l?0:l))return A(n,f,t)?o.splice(e,1):o[e]=f,!1}))}var c=E.get(t);a?i.files=o:S(t,o),i&&delete c.sessions[i.sessionId],T(c,!0,i)},E.clear=function(e){o=null;var t=E.get(e);t&&(t.activeSession=null,t.edited=!1),0!=P(e).length&&(S(e,[]),T(E.get(e),!1))},E.subscribe=function(e,t,n){h.on(t+"."+e,n)},E.unsubscribe=function(e,t,n){h.off(t+"."+e,n)},E.getFiles=function(e){return P(e)},E.callGifPaymentWizard=function(){a.ajax({url:"/dk?cmd=PopLayer",data:{"st.layer.cmd":"PopLayerPaymentWizardOuter","st.layer.srv":"46","st.layer.t2nd":"off","st.layer.redirect":"","st.layer.stJsCb":"attachGifCb"}}).done((function(e,t,n){a.updateBlockModelCallback(e,t,n)}))},E.destroy=function(e){var t=s[e];if(t._counter--,t._counter<=0){if(t.button&&(t.button.off(),t.button.removeData(),t.button=null),t.previewContainer&&(t.previewContainer.off(),t.previewContainer.removeData(),t.previewContainer=null),t.warningContainer&&(t.warningContainer.off(),t.warningContainer.removeData(),t.warningContainer=null),t.attachedInput&&(t.attachedInput.off(),t.attachedInput.removeData(),t.attachedInput=null),t.sessions){for(var n in t.sessions)t.sessions.hasOwnProperty(n)&&delete t.sessions[n];t.sessions=null,t.activeSession=null}t.off(),s[t.objectId]=void 0,--l||(r.SELECT_PHOTO_IDS.off(y),r.SELECT_PHOTO_FILE.off(b),r.UPLOAD_DND_FILE.off(b),i.PHOTO_UPLOADED_WITH_DELAYED_SAVE.off(w),i.PHOTO_UPLOAD_ERROR.off(I))}},E.prototype={activate:function(t){var n=e(t),r=this.objectId=n.data("object-id")||e(".js-chat").attr("data-object-id"),i=E.get(r,!0),a=n.data("preview-url");a&&(i.previewUrl=a,i.previewContainer=e("#"+n.data("preview-id")));var o=n.data("allocate-url");o&&(i.allocateUrl=o),n.data("single")&&(i.single=!0);var s=n.data("use-local-storage");i.supportsLs=u&&(void 0===s||s);var l=n.data("attached-ids");if(l&&S(r,l),!i.single){var f=n.data("max-count");f&&(i.maxCount=parseInt(f,10))}var c=n.attr("data-separate-types");c&&(i.separateUploadTypes=c.replace(/^\[/,"").replace(/]$/,"").split(","));var d=n.data("button-id");d&&(i.button=e("#"+d),i.button.click((function(e){return O(i),e.stopPropagation(),!1})));var h=n.attr("data-attach-type"),m="true"===n.attr("data-instant");i.warningContainer=i.warningContainer.add(".tipAttachPicker",n);var v=e(".attachedInput",n);i.attachedInput=i.attachedInput.add(v);var y=n.attr("data-place");y&&(i.place=y);var b=e(".attachButton",n);b.length>0?b.click((function(){var e=g(r),t=[];n.find("input:hidden").each((function(){var n=this.value;if(n&&!isNaN(parseInt(n,10))){var r=!1;if(t.every((function(e){return!e.id||!e.type||e.id!==n||e.type!==h||(r=!0,!1)})),r)return;if(e){var i=this;"MUSIC"===h?t.push({type:"MUSIC",trackId:Number(n),title:i.getAttribute("data-name"),artistName:i.getAttribute("data-artist"),imageUrl:i.getAttribute("data-cover"),duration:i.getAttribute("data-duration"),context:i.getAttribute("data-ctx")}):t.push({id:n,type:String(h),url:i.getAttribute("data-url"),previewUrl:i.getAttribute("data-preview"),width:i.getAttribute("data-width"),height:i.getAttribute("data-height")})}else t.push(E.serialize(n,h))}})),m?i.trigger("instantSendAttaches",[t]):E.add(r,t),p(r,t),this.classList.add("__disabled")})):e(".attachInput",n).click((function(){var t=e(this),n=t.data("id");if(t.data("add"))if("RECENTGIF"===h)E.addRecentGif(r,t);else{var i=this.querySelector("img");g(r)?p(r,[{id:n,type:h,preview:i&&i.src,width:this.getAttribute("data-width"),height:this.getAttribute("data-height")}]):E.add(r,[E.serialize(n,h)])}else E.remove(r,n)})),(a||v.length)&&P(r).length>0&&T(i,!1)},deactivate:function(t){var n=e(t);s[this.objectId];e(".attachButton, .attachInput",n).off("click"),n.removeData(),E.destroy(this.objectId)}},E})),define("OK/messages/UnsentMessages",["require","OK/utils/dom","OK/utils/utils","OK/logger","OK/AttachPicker"],(function(require){"use strict";var e,t,n=require("OK/utils/dom"),r=require("OK/utils/utils"),i=require("OK/logger"),a=require("OK/AttachPicker"),o="invisible",s="msg_found_",l=n.firstByClass(document,"js-unsent-msg-marker"),u=l&&l.getAttribute("data-store-key"),f="localStorage"in window&&null!==window.localStorage,c=!!u&&f,d=c&&JSON.parse(localStorage.getItem(u))||{},h=[],g={},p=function(){clearTimeout(e),e=setTimeout((function(){localStorage.setItem(u,JSON.stringify(d))}),10)},m=function(e){return e&&0===Object.keys(e).length&&e.constructor===Object},v=function(){h.forEach((function(e){e.call()}))},y=function(e){return 0===e.lastIndexOf(s,0)&&(e=e.substring(10)),e};return t=!1,Object.keys(d).forEach((function(e){0===e.lastIndexOf(s,0)&&(delete d[e],i.success("messagesLayer","unsentFix"),t=!0)})),t&&p(),{registerAndCheck:function(e){c&&(h.push(e),this.hasUnsentMessages()&&e(d))},addMessage:function(e,t,n,i){if(c){e=y(e);var a={},o={};o[t]=n,a[e]=o,i?r.extendDeep(g,a):(r.extendDeep(g,a),r.extendDeep(d,a),p())}},removeAsync:function(e,t){if(c){e=y(e);var n=g[e];n&&(delete n[t],m(n)&&delete g[e])}},removeMessage:function(e,t){this.removeAsync(e,t);var n=d[e];n&&(delete n[t],m(n)&&(delete d[e],v())),p()},removeConv:function(e){if(c){var t=g[e];t&&delete g[e],(t=d[e])&&(delete d[e],v()),p()}},hasUnsentMessages:function(){return!m(d)&&(!!m(g)||Object.keys(d).some((function(e){if(g[e]){var t=d[e],n=g[e];return Object.keys(t).some((function(e){return!n[e]}))}return!0})))},getUnsentMessages:function(e){return this.hasUnsentMessages()&&d[e]||{}},getAsyncMessages:function(e){return g[e]||{}},getUnsentConversations:function(){return Object.keys(d)},onAsycContinue:function(e,t,n){this.onSendRetry(e,t,"asyncUpload",(function(){if(n&&n.sessions&&Object.keys(n.sessions).length>0){var e=a.findSession(n.objectId,t);a.remove(n.objectId,void 0,e)}}))},onSendRetry:function(e,t,r,a){var s=0;try{var l,u,f,c=this,d=e.getStubEl(t),h=function(){},g=function(e){u.classList.toggle(o,!e)},p=function(e){f.classList.toggle(o,!e),l.classList.toggle(o,e),d.classList.toggle("__error",!e)},m=function(){s=71,u=n.removeAllListeners(u),s=72,u.addEventListener("click",(function(){s=73,h.call(),s=74,c.removeMessage(e.conversation.id,t),s=75,e.removeStub(t)})),s=76,g(!0)},v=function(){l=n.removeAllListeners(l),n.one(l,"click",(function(){p(!0),a.call()}))};if(s=1,!d)return;switch(s=2,l=n.firstByClass(d,"js-retry-button"),s=3,u=n.firstByClass(d,"js-stub-delete-button"),s=4,f=n.firstByClass(d,"js-retry-spinner"),s=5,r){case"onError":m();break;case"asyncUpload":h=a,m(),p(!0);break;case"autoRetry":s=6,h=a,s=7,m(),s=8,p(!0);break;case"manualRetry":s=9,v(),s=10,m(),s=11,p(!1);break;case"onConvActivate":s=111,l&&!l.classList.contains(o)?(s=12,v(),s=13,m()):(s=14,g(!1))}}catch(e){i.success("messagesLayer","e.onSendRetry_"+s)}}}})),define("OK/messages/MessageDelivery",["require","OK/messages/MessagesPushController","OK/utils/utils","OK/logger","OK/messages/MessagesConfig"],(function(require){"use strict";var e=require("OK/messages/MessagesPushController"),t=require("OK/utils/utils"),n=require("OK/logger"),r=require("OK/messages/MessagesConfig");function i(e){if(!e)return!0;var i,a,o,s=e.updatedConversations,l=e.unreadCount?e.unreadCount.conv:0,u=0;if(!s||!l)return!0;try{var f=[];Object.keys(s).forEach((function(e){u=1,(i=s[e])&&i.groupId&&(u=2,f.push(e))})),f.length&&(u=3,a=f,(o=r.get()).sendDeliveredToClient&&t.ajax({url:"/web-api/messages/conversation/markAsDelivered",data:{cid:a},timeout:o.ajaxTimeout},o.ajaxRetryCount).fail((function(){n.error("messagesLayer.error","markAsDelivered")})))}catch(e){n.success("sendDeliveredToClient","e.send_"+u)}return!0}return{activate:function(t){e.register({name:"sendDeliveredToClient",priority:e.priority.medium,dependsOn:"convMgt_newMsg",applyNews:function(e){return i(e)}})}}})),define("OK/messages/MessagesToolbarButton",["module","OK/logger","OK/messages/MessagesToggleButton","OK/messages/MessagesPushController","OK/ToolbarBubble","OK/messages/Helper","OK/messages/UnsentMessages","OK/utils/dom","OK/utils/utils","OK/ToolbarGrowl","OK/messages/MessageDelivery"],(function(e,t,n,r,i,a,o,s,l,u,f){"use strict";var c=i.wrap("counter_ToolbarMessages");return r.register({name:"toolbarBtn",priority:r.priority.medium,dependsOn:"convMgt_newMsg",applyNews:function(e){a.newMessageNotify(e.unreadCount)}}),{activate:function(e){n.activate(e),f.activate(e),o.registerAndCheck((function(){e.classList.toggle("__unsent-warn",o.hasUnsentMessages())})),"1"===e.getAttribute("data-growl")&&c.hasBubble()&&("1"===e.getAttribute("data-growl-add-log")&&t.success("messagesLayer","messageGrowlLoad","ok"),l.ajax({url:"/dk?cmd=MessagesGrowl"}).done((function(e,t,n){l.updateBlockModelCallback(e,t,n)}))),"true"===e.getAttribute("data-ws")&&require(["OK/WSConnectionCheck"],(function(e){e.check()}))},deactivate:function(e){n.deactivate(e)}}})),define("b/messagesButton",["OK/messages/BrowserNotifications","OK/messages/Helper","OK/messages/MessagesAlert","OK/messages/MessagesConfig","OK/messages/MessagesPushController","OK/messages/MessagesToggleButton","OK/messages/MessagesToolbarButton","OK/messages/UnsentMessages","OK/messages/WindowTitleChanger","OK/messages/WindowVisibility","OK/messages/SoundPlayer","OK/messages/MessageDelivery","OK/messages/Timing"],{});
//# sourceMappingURL=/res/source-maps/js/b/messagesButton.js.map