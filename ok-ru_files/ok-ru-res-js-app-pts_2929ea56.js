define(["module","OK/logger","OK/utils/vanilla"],(function(e,t,n){"use strict";var r,s={},u=[],i={},o=e.config().timeout||3e5;function a(e){var t=s[e];return t&&0!==Object.keys(t).length||!OK.fn.isDebug()||console.error('Пакет "'+e+'" отсутствует. Наверно, не удалось загрузить'),s[e]}function h(e,t){return s[e]=new c(e,t),function(e){for(var t=i[e]||[],n=t.length;n--;)t[n]()}(e),a(e)}function c(e,t){this.pkg=e,this.messages=t,this.parsedResources={}}function f(e){this.text=e}function g(e){this.argName=e}function l(e,t){this.argName=e,this.values=t}function p(e,t){this.argName=e,this.values=t}function v(e){return(e=Math.abs(e))%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}function d(e){return 1===e?0:1}function w(e){return 0}c.prototype={has:function(e){return this.messages.hasOwnProperty(e)},getLMsg:function(e,n){if(!e&&!n)return this.messages;var r=this.messages[e];if("string"!=typeof r)return t.success("pts.miss",this.pkg,e),this.pkg+"."+e;if(n){var s=this.parsedResources[e];return s||(s=function(e){for(var t=[],n=0;;){var r=y(t,e,n);if(r===e.length)break;n===r&&r++,n=r}return k(t)}(r),this.parsedResources[e]=s),s.getResource(n)}return r},subscribe:function(e){var t=this.pkg;i[t]||(i[t]=[]),i[t].push(e)}},f.prototype.getResource=function(){return n.unescapeXml(n.encodeHtml(this.text))},g.prototype.getResource=function(e){var t=e[this.argName];return t||0===t?t:""},l.prototype.getResource=function(e){var t=e[this.argName],n=t;"Plural"===this.argName.substr(-"Plural".length)&&(n=m.getIndex(t));var r=this.values[n];return r?r.getResource(e):""},p.prototype.getResource=function(e){var t=e[this.argName],n=this.values[t];return n?n.getResource(e):""};var m={ru:v,uk:v,en:d,hy:d,mo:d,ro:d,de:d,uz:w,az:w,kk:w,ka:w,ky:w,tg:w,tr:w,getIndex:function(e){var t=document.body.parentElement.getAttribute("lang"),n=m[t];return n||(n=v),n(e)}};function b(e){this.children=e}function y(e,t,n){var r,s;if(-1===(r=R(t,n,"|[]")))return-1===(r=R(t,n,"]"))?(e.push(new f(t.substr(n))),t.length):(e.push(new f(t.substr(n,r-n))),r);if(r>n)return e.push(new f(t.substr(n,r-n))),r;if("["===t[r]){if(-1===(r=R(t,n=r+1,":?]")))return n--,e.push(new f(t.substr(n))),t.length;var u=(s=t.substr(n,r-n))?s.replace(/^\s+|\s+$/gm,""):"";if("]"===t[r])return e.push(new g(u)),r+1;var i=t[r],o="?"===i,a=o?{}:[];if("?"!==i&&":"!==i)return r=R(t,n,"]"),e.push(new f(t.substr(n-1,r))),t.length;for(;;){n=r+1;var h,c=[];if(o){if(!((r=R(t,n,"="))>n))return r=R(t,n,"]"),e.push(new f(t.substr(n,r))),t.length;h=t.substr(n,r-n),n=r+1}for(;(r=y(c,t,n))!==t.length&&("|"!==t[r]&&"]"!==t[r]);)n==r&&r++,n=r;if(o?a[h]=k(c):a.push(k(c)),r===t.length||"]"===t[r])break}return o?e.push(new p(u,a)):e.push(new l(u,a)),r===t.length?t.length:r+1}return r}function k(e){return 0===e.length?new f(""):1===e.length?e[0]:new b(e)}function R(e,t,n){for(var r=t;r<e.length;r++)for(var s=0;s<n.length;s++)if(n[s]===e[r])return r;return-1}function O(){for(var e,t=[],n=0,r=u.length;n<r;n+=1){var s=a(e=u[n]);t.push({pkg:e,hash:s&&s.messages.$Hash$||"0"})}return JSON.stringify(t)}function N(){n.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:O(),dataType:"json"}).then((function(e){for(var t,n=e.response,r=Object.keys(n),s=0,u=r.length;s<u;s+=1)h(t=r[s],n[t])}))}function x(e){e&&(-1===u.indexOf(e)&&u.push(e),!r&&o>0&&(r=window.setInterval(N,o)))}if(b.prototype.getResource=function(e){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].getResource(e);return t},"undefined"!=typeof window&&(window.l10n={getPkg:function(e){return x(e),a(e)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pts)){for(var P in window.inline_resources.pts)h(P,window.inline_resources.pts[P]),x(P);window.inline_resources.pts={}}return{load:function(e,t,n,r){r.isBuild?n():!function(e){return s.hasOwnProperty(e)}(e)?t(["PTS/"+e],(function(t){h(e,t),n(a(e))})):n(a(e))}}}));
//# sourceMappingURL=/res/source-maps/js/app/pts.js.map